--
-- Script was generated by Devart dbForge Studio for MySQL, Version 7.4.201.0
-- Product home page: http://www.devart.com/dbforge/mysql/studio
-- Script date 05-May-18 2:56:03 PM
-- Server version: 5.5.56-MariaDB
-- Client version: 4.1
--

-- 
-- Disable foreign keys
-- 
/*!40014 SET @OLD_FOREIGN_KEY_CHECKS=@@FOREIGN_KEY_CHECKS, FOREIGN_KEY_CHECKS=0 */;

-- 
-- Set SQL mode
-- 
/*!40101 SET @OLD_SQL_MODE=@@SQL_MODE, SQL_MODE='NO_AUTO_VALUE_ON_ZERO' */;

-- 
-- Set character set the client will use to send SQL statements to the server
--
SET NAMES 'utf8';

--
-- Set default database
--
USE onetime;

--
-- Drop table `tbl_log_administracion_turnos`
--
DROP TABLE IF EXISTS tbl_log_administracion_turnos;

--
-- Drop table `tbl_log_usuarios`
--
DROP TABLE IF EXISTS tbl_log_usuarios;

--
-- Drop table `tbl_marquesina_pantalla`
--
DROP TABLE IF EXISTS tbl_marquesina_pantalla;

--
-- Drop table `tbl_system_app`
--
DROP TABLE IF EXISTS tbl_system_app;

--
-- Drop table `tbl_tiempo_atencion_turnos`
--
DROP TABLE IF EXISTS tbl_tiempo_atencion_turnos;

--
-- Drop table `tbl_videos`
--
DROP TABLE IF EXISTS tbl_videos;

--
-- Drop procedure `SP_GenerarLlamadaTurno`
--
DROP PROCEDURE IF EXISTS SP_GenerarLlamadaTurno;

--
-- Drop procedure `SP_GenerarLlamadaTurno_ORIGINAL`
--
DROP PROCEDURE IF EXISTS SP_GenerarLlamadaTurno_ORIGINAL;

--
-- Drop table `tmp_turnos_ordenados`
--
DROP TABLE IF EXISTS tmp_turnos_ordenados;

--
-- Drop procedure `SP_GetListTurnosEsperaByPuesto`
--
DROP PROCEDURE IF EXISTS SP_GetListTurnosEsperaByPuesto;

--
-- Drop table `tmp_turnos_espera`
--
DROP TABLE IF EXISTS tmp_turnos_espera;

--
-- Drop view `vw_botones_departamentos`
--
DROP VIEW IF EXISTS vw_botones_departamentos CASCADE;

--
-- Drop table `pv_botones_turnos_departamentos`
--
DROP TABLE IF EXISTS pv_botones_turnos_departamentos;

--
-- Drop view `vw_permisos_modulos_usuarios`
--
DROP VIEW IF EXISTS vw_permisos_modulos_usuarios CASCADE;

--
-- Drop table `tbl_perfiles_usuarios_permisos_modulos`
--
DROP TABLE IF EXISTS tbl_perfiles_usuarios_permisos_modulos;

--
-- Drop view `vw_usuarios`
--
DROP VIEW IF EXISTS vw_usuarios CASCADE;

--
-- Drop table `tbl_perfiles_usuarios`
--
DROP TABLE IF EXISTS tbl_perfiles_usuarios;

--
-- Drop table `tbl_modulos_aplicacion`
--
DROP TABLE IF EXISTS tbl_modulos_aplicacion;

--
-- Drop view `vw_administracion_turnos_prioridad_puestos`
--
DROP VIEW IF EXISTS vw_administracion_turnos_prioridad_puestos CASCADE;

--
-- Drop procedure `SP_CambiarModoLlamadaPuesto`
--
DROP PROCEDURE IF EXISTS SP_CambiarModoLlamadaPuesto;

--
-- Drop view `vw_prioridades_turnos_puesto`
--
DROP VIEW IF EXISTS vw_prioridades_turnos_puesto CASCADE;

--
-- Drop view `vw_puestos_prioridades`
--
DROP VIEW IF EXISTS vw_puestos_prioridades CASCADE;

--
-- Drop table `tbl_prioridades_turnos`
--
DROP TABLE IF EXISTS tbl_prioridades_turnos;

--
-- Drop view `vw_pvt_puestos_usuarios`
--
DROP VIEW IF EXISTS vw_pvt_puestos_usuarios CASCADE;

--
-- Drop table `pv_usuarios_puestos`
--
DROP TABLE IF EXISTS pv_usuarios_puestos;

--
-- Drop table `tbl_prioridad_turnos_puestos`
--
DROP TABLE IF EXISTS tbl_prioridad_turnos_puestos;

--
-- Drop procedure `SP_GetTotalTurnosByEstadoToday`
--
DROP PROCEDURE IF EXISTS SP_GetTotalTurnosByEstadoToday;

--
-- Drop view `vw_administracion_turnos`
--
DROP VIEW IF EXISTS vw_administracion_turnos CASCADE;

--
-- Drop view `vw_puestos_sucursales`
--
DROP VIEW IF EXISTS vw_puestos_sucursales CASCADE;

--
-- Drop table `tbl_puestos`
--
DROP TABLE IF EXISTS tbl_puestos;

--
-- Drop procedure `SP_ActualizarEstadoTurno`
--
DROP PROCEDURE IF EXISTS SP_ActualizarEstadoTurno;

--
-- Drop procedure `SP_GetNextTurn`
--
DROP PROCEDURE IF EXISTS SP_GetNextTurn;

--
-- Drop procedure `SP_ReactivarTurnoAnulado`
--
DROP PROCEDURE IF EXISTS SP_ReactivarTurnoAnulado;

--
-- Drop procedure `SP_TransferirTurnoAPuesto`
--
DROP PROCEDURE IF EXISTS SP_TransferirTurnoAPuesto;

--
-- Drop table `tbl_administracion_turnos`
--
DROP TABLE IF EXISTS tbl_administracion_turnos;

--
-- Drop table `tbl_botones_turnos`
--
DROP TABLE IF EXISTS tbl_botones_turnos;

--
-- Drop view `vw_departamentos_sucursales`
--
DROP VIEW IF EXISTS vw_departamentos_sucursales CASCADE;

--
-- Drop table `tbl_departamentos`
--
DROP TABLE IF EXISTS tbl_departamentos;

--
-- Drop view `vw_sucursales_empresa`
--
DROP VIEW IF EXISTS vw_sucursales_empresa CASCADE;

--
-- Drop table `tbl_sucursales`
--
DROP TABLE IF EXISTS tbl_sucursales;

--
-- Drop table `tbl_empresa`
--
DROP TABLE IF EXISTS tbl_empresa;

--
-- Drop table `tbl_estados_turnos`
--
DROP TABLE IF EXISTS tbl_estados_turnos;

--
-- Drop table `tbl_usuarios`
--
DROP TABLE IF EXISTS tbl_usuarios;

--
-- Drop table `tbl_estatus_turnos`
--
DROP TABLE IF EXISTS tbl_estatus_turnos;

--
-- Set default database
--
USE onetime;

--
-- Create table `tbl_estatus_turnos`
--
CREATE TABLE tbl_estatus_turnos (
  Id int(11) NOT NULL,
  Estatus varchar(45) DEFAULT NULL,
  Descripcion text DEFAULT NULL,
  CreadoPorUsuarioID int(11) DEFAULT NULL,
  FechaCreacion datetime DEFAULT NULL,
  ModificadoPorUsuarioID int(11) DEFAULT NULL,
  FechaModificacion datetime DEFAULT NULL,
  Activo tinyint(4) DEFAULT 1,
  PRIMARY KEY (Id)
)
ENGINE = MYISAM,
AVG_ROW_LENGTH = 16384,
CHARACTER SET utf8,
CHECKSUM = 0,
COLLATE utf8_general_ci;

--
-- Create index `Estatus_UNIQUE` on table `tbl_estatus_turnos`
--
ALTER TABLE tbl_estatus_turnos
ADD UNIQUE INDEX Estatus_UNIQUE (Estatus);

--
-- Create table `tbl_usuarios`
--
CREATE TABLE tbl_usuarios (
  Id int(11) NOT NULL AUTO_INCREMENT,
  PerfilUsuarioID int(11) NOT NULL,
  PuestoID int(11) NOT NULL,
  Nombre varchar(50) CHARACTER SET latin1 COLLATE latin1_swedish_ci NOT NULL,
  Apellido varchar(50) CHARACTER SET latin1 COLLATE latin1_swedish_ci DEFAULT NULL,
  Usuario varchar(50) CHARACTER SET latin1 COLLATE latin1_swedish_ci NOT NULL,
  Password text CHARACTER SET latin1 COLLATE latin1_swedish_ci NOT NULL,
  Email varchar(100) DEFAULT NULL,
  Imagen text CHARACTER SET latin1 COLLATE latin1_swedish_ci DEFAULT NULL,
  CreadoPorUsuarioID varchar(50) DEFAULT NULL,
  FechaCreacion datetime DEFAULT NULL,
  ModificadoPorUsuarioID int(11) DEFAULT NULL,
  FechaModificacion datetime DEFAULT NULL,
  Activo tinyint(4) DEFAULT 1,
  PRIMARY KEY (Id)
)
ENGINE = MYISAM,
AUTO_INCREMENT = 16,
AVG_ROW_LENGTH = 2340,
CHARACTER SET utf8,
CHECKSUM = 0,
COLLATE utf8_general_ci;

--
-- Create index `Email_UNIQUE` on table `tbl_usuarios`
--
ALTER TABLE tbl_usuarios
ADD UNIQUE INDEX Email_UNIQUE (Email);

--
-- Create index `Usuario_UNIQUE` on table `tbl_usuarios`
--
ALTER TABLE tbl_usuarios
ADD UNIQUE INDEX Usuario_UNIQUE (Usuario);

--
-- Create table `tbl_estados_turnos`
--
CREATE TABLE tbl_estados_turnos (
  Id int(11) NOT NULL AUTO_INCREMENT,
  Estado varchar(10) DEFAULT NULL,
  Descripcion varchar(50) DEFAULT NULL,
  CreadoPorUsuarioID int(11) DEFAULT NULL,
  FechaCreacion datetime DEFAULT NULL,
  ModificadoPorUsuarioID int(11) DEFAULT NULL,
  FechaModificacion datetime DEFAULT NULL,
  Activo tinyint(4) DEFAULT 1,
  PRIMARY KEY (Id)
)
ENGINE = MYISAM,
AUTO_INCREMENT = 7,
AVG_ROW_LENGTH = 2730,
CHARACTER SET utf8,
CHECKSUM = 0,
COLLATE utf8_general_ci;

--
-- Create index `Estado_UNIQUE` on table `tbl_estados_turnos`
--
ALTER TABLE tbl_estados_turnos
ADD UNIQUE INDEX Estado_UNIQUE (Estado);

--
-- Create table `tbl_empresa`
--
CREATE TABLE tbl_empresa (
  Id int(11) NOT NULL,
  Codigo varchar(50) DEFAULT NULL,
  Nombre varchar(100) NOT NULL,
  Descripcion text DEFAULT NULL,
  LogoGrande text DEFAULT NULL,
  LogoPeq text DEFAULT NULL,
  Telefono varchar(20) DEFAULT NULL,
  Direccion text DEFAULT NULL,
  Rnc varchar(30) DEFAULT NULL,
  CreadoPorUsuarioID int(11) DEFAULT NULL,
  FechaCreacion datetime DEFAULT NULL,
  ModificadoPorUsuarioID int(11) DEFAULT NULL,
  FechaModificacion datetime DEFAULT NULL,
  Activo tinyint(4) DEFAULT 1,
  PRIMARY KEY (Id)
)
ENGINE = MYISAM,
AVG_ROW_LENGTH = 16384,
CHARACTER SET utf8,
CHECKSUM = 0,
COLLATE utf8_general_ci;

--
-- Create index `Codigo_UNIQUE` on table `tbl_empresa`
--
ALTER TABLE tbl_empresa
ADD UNIQUE INDEX Codigo_UNIQUE (Codigo);

--
-- Create index `Nombre_UNIQUE` on table `tbl_empresa`
--
ALTER TABLE tbl_empresa
ADD UNIQUE INDEX Nombre_UNIQUE (Nombre);

--
-- Create table `tbl_sucursales`
--
CREATE TABLE tbl_sucursales (
  Id int(11) NOT NULL AUTO_INCREMENT,
  EmpresaID int(11) NOT NULL,
  Codigo varchar(50) DEFAULT NULL,
  Nombre varchar(100) NOT NULL,
  Descripcion text DEFAULT NULL,
  Direccion text DEFAULT NULL,
  Telefono varchar(25) DEFAULT NULL,
  CreadoPorUsuarioID int(11) DEFAULT NULL,
  FechaCreacion datetime DEFAULT NULL,
  ModificadoPorUsuarioID int(11) DEFAULT NULL,
  FechaModificacion datetime DEFAULT NULL,
  Activo tinyint(4) DEFAULT 1,
  PRIMARY KEY (Id)
)
ENGINE = MYISAM,
AUTO_INCREMENT = 2,
AVG_ROW_LENGTH = 16384,
CHARACTER SET utf8,
CHECKSUM = 0,
COLLATE utf8_general_ci;

--
-- Create index `Codigo_UNIQUE` on table `tbl_sucursales`
--
ALTER TABLE tbl_sucursales
ADD UNIQUE INDEX Codigo_UNIQUE (Codigo);

--
-- Create index `empresa_id` on table `tbl_sucursales`
--
ALTER TABLE tbl_sucursales
ADD INDEX empresa_id (EmpresaID);

--
-- Create index `Nombre_UNIQUE` on table `tbl_sucursales`
--
ALTER TABLE tbl_sucursales
ADD UNIQUE INDEX Nombre_UNIQUE (Nombre);

--
-- Create view `vw_sucursales_empresa`
--
CREATE
DEFINER = 'root'@'localhost'
VIEW vw_sucursales_empresa
AS
SELECT
  `a`.`Id` AS `Id`,
  `a`.`Codigo` AS `Codigo`,
  `a`.`Nombre` AS `Nombre`,
  `a`.`Descripcion` AS `Descripcion`,
  `a`.`Direccion` AS `Direccion`,
  `a`.`Telefono` AS `Telefono`,
  `a`.`FechaCreacion` AS `FechaCreacion`,
  `b`.`Id` AS `EmpresaID`,
  `b`.`Nombre` AS `Empresa`,
  `a`.`Activo` AS `Activo`
FROM (`tbl_sucursales` `a`
  JOIN `tbl_empresa` `b`
    ON ((`a`.`EmpresaID` = `b`.`Id`)));

--
-- Create table `tbl_departamentos`
--
CREATE TABLE tbl_departamentos (
  Id int(11) NOT NULL AUTO_INCREMENT,
  SucursalID int(11) NOT NULL,
  Codigo varchar(50) DEFAULT NULL,
  Nombre varchar(100) NOT NULL,
  Descripcion text DEFAULT NULL,
  CreadoPorUsuarioID int(11) DEFAULT NULL,
  FechaCreacion datetime DEFAULT NULL,
  ModificadoPorUsuarioID int(11) DEFAULT NULL,
  FechaModificacion datetime DEFAULT NULL,
  Activo tinyint(4) DEFAULT 1,
  PRIMARY KEY (Id)
)
ENGINE = MYISAM,
AUTO_INCREMENT = 2,
AVG_ROW_LENGTH = 8192,
CHARACTER SET utf8,
CHECKSUM = 0,
COLLATE utf8_general_ci;

--
-- Create index `Codigo_UNIQUE` on table `tbl_departamentos`
--
ALTER TABLE tbl_departamentos
ADD UNIQUE INDEX Codigo_UNIQUE (Codigo);

--
-- Create index `depto_id` on table `tbl_departamentos`
--
ALTER TABLE tbl_departamentos
ADD UNIQUE INDEX depto_id (Id);

--
-- Create index `Nombre_UNIQUE` on table `tbl_departamentos`
--
ALTER TABLE tbl_departamentos
ADD UNIQUE INDEX Nombre_UNIQUE (Nombre);

--
-- Create index `sucursal_id` on table `tbl_departamentos`
--
ALTER TABLE tbl_departamentos
ADD INDEX sucursal_id (SucursalID);

--
-- Create view `vw_departamentos_sucursales`
--
CREATE
DEFINER = 'root'@'localhost'
VIEW vw_departamentos_sucursales
AS
SELECT
  `a`.`Id` AS `Id`,
  `a`.`Codigo` AS `Codigo`,
  `a`.`Nombre` AS `Departamento`,
  `a`.`Descripcion` AS `Descripcion`,
  `a`.`SucursalID` AS `SucursalID`,
  `b`.`Nombre` AS `Sucursal`,
  `d`.`Id` AS `EmpresaID`,
  `d`.`Nombre` AS `Empresa`,
  `a`.`FechaCreacion` AS `FechaCreacion`,
  `a`.`Activo` AS `Activo`
FROM ((`tbl_departamentos` `a`
  LEFT JOIN `tbl_sucursales` `b`
    ON ((`a`.`SucursalID` = `b`.`Id`)))
  JOIN `tbl_empresa` `d`
    ON ((`b`.`EmpresaID` = `d`.`Id`)));

--
-- Create table `tbl_botones_turnos`
--
CREATE TABLE tbl_botones_turnos (
  Id int(11) NOT NULL AUTO_INCREMENT,
  Nombre varchar(50) CHARACTER SET latin1 COLLATE latin1_swedish_ci NOT NULL,
  Icono varchar(100) CHARACTER SET latin1 COLLATE latin1_swedish_ci DEFAULT NULL,
  Color varchar(45) CHARACTER SET latin1 COLLATE latin1_swedish_ci DEFAULT NULL,
  TextoGraMostrar varchar(45) CHARACTER SET latin1 COLLATE latin1_swedish_ci NOT NULL,
  TextoPeqMostrar varchar(45) CHARACTER SET latin1 COLLATE latin1_swedish_ci DEFAULT NULL,
  ValorBoton varchar(45) CHARACTER SET latin1 COLLATE latin1_swedish_ci DEFAULT NULL,
  TipoBoton varchar(50) CHARACTER SET latin1 COLLATE latin1_swedish_ci NOT NULL,
  Logo text DEFAULT NULL,
  CreadoPorUsuarioID int(11) DEFAULT NULL,
  FechaCreacion datetime NOT NULL,
  ModificadoPorUsuarioID int(11) DEFAULT NULL,
  FechaModificacion datetime DEFAULT NULL,
  Activo tinyint(1) DEFAULT 1,
  PRIMARY KEY (Id)
)
ENGINE = MYISAM,
AUTO_INCREMENT = 8,
AVG_ROW_LENGTH = 2730,
CHARACTER SET utf8,
CHECKSUM = 0,
COLLATE utf8_general_ci;

--
-- Create index `Nombre_UNIQUE` on table `tbl_botones_turnos`
--
ALTER TABLE tbl_botones_turnos
ADD UNIQUE INDEX Nombre_UNIQUE (Nombre);

--
-- Create index `ValorBoton_UNIQUE` on table `tbl_botones_turnos`
--
ALTER TABLE tbl_botones_turnos
ADD UNIQUE INDEX ValorBoton_UNIQUE (ValorBoton);

--
-- Create table `tbl_administracion_turnos`
--
CREATE TABLE tbl_administracion_turnos (
  Id int(11) NOT NULL AUTO_INCREMENT,
  BotonTurnoID int(11) DEFAULT NULL,
  Turno varchar(45) DEFAULT NULL,
  EstadoTurnoID int(11) DEFAULT NULL,
  EstatusTurnoID int(11) DEFAULT NULL,
  FechaHoraLlamada datetime DEFAULT NULL,
  CantReLlamadas int(11) DEFAULT NULL,
  FechaHoraReLlamada datetime DEFAULT NULL,
  FechaHoraAnulacion datetime DEFAULT NULL,
  FechaHoraSeleccion datetime DEFAULT NULL,
  FechaHoraEnPuesto datetime DEFAULT NULL,
  TransferidoAPuestoID int(11) DEFAULT NULL,
  FechaHoraTransferido datetime DEFAULT NULL,
  FechaHoraFinalizar datetime DEFAULT NULL,
  PuestoID int(11) DEFAULT NULL,
  DepartamentoID int(11) DEFAULT NULL,
  SucursalID int(11) DEFAULT NULL,
  Comentario text DEFAULT NULL,
  ComentarioTransferencia varchar(255) DEFAULT NULL,
  IDExterno varchar(45) DEFAULT NULL,
  CampoExterno varchar(45) DEFAULT NULL,
  FechaCreacion datetime DEFAULT NULL,
  CreadoPorUsuarioID int(11) DEFAULT NULL,
  FechaModificacion date DEFAULT NULL,
  ModificadoPorUsuarioID int(11) DEFAULT NULL,
  Activo tinyint(4) DEFAULT 1,
  PRIMARY KEY (Id)
)
ENGINE = MYISAM,
AVG_ROW_LENGTH = 1092,
CHARACTER SET latin1,
CHECKSUM = 0,
COLLATE latin1_swedish_ci;

DELIMITER $$

--
-- Create procedure `SP_TransferirTurnoAPuesto`
--
CREATE DEFINER = 'root'@'localhost'
PROCEDURE SP_TransferirTurnoAPuesto (IN TurnoID int, IN NuevoPuestoID int, IN InComentario varchar(200), IN ModificadoPorUsuarioID int)
BEGIN

  DECLARE EstadoTurnoTransferido int;

  SET EstadoTurnoTransferido = (SELECT
      E.Id
    FROM onetime.tbl_estados_turnos AS E
    WHERE E.Descripcion = 'TRANSFERIDO');

  UPDATE tbl_administracion_turnos
  SET TransferidoAPuestoID = NuevoPuestoID,
      ComentarioTransferencia = InComentario,
      FechaHoraTransferido = NOW(),
      EstadoTurnoID = EstadoTurnoTransferido,
      FechaModificacion = NOW(),
      ModificadoPorUsuarioID = ModificadoPorUsuarioID
  WHERE Id = TurnoID;

END
$$

--
-- Create procedure `SP_ReactivarTurnoAnulado`
--
CREATE DEFINER = 'root'@'localhost'
PROCEDURE SP_ReactivarTurnoAnulado (IN InTurnoID int, IN InUsuarioID int)
BEGIN
  DECLARE InEstadoID int;

  SET InEstadoID = (SELECT
      e.Id
    FROM onetime.tbl_estados_turnos AS e
    WHERE e.Estado = 'E'
    AND e.Activo = 1);


  UPDATE onetime.tbl_administracion_turnos
  SET EstadoTurnoID = InEstadoID,
      EstatusTurnoID = NULL,
      Comentario = CONCAT(Comentario, ' | ', 'TURNO REACTIVADO'),
      FechaModificacion = NOW(),
      ModificadoPorUsuarioID = InUsuarioID
  WHERE Id = InTurnoID;


END
$$

--
-- Create procedure `SP_GetNextTurn`
--
CREATE DEFINER = 'root'@'localhost'
PROCEDURE SP_GetNextTurn (IN `BotonTurnoID` int, IN `CreadoPorUsuarioID` int, IN `DepartamentoID` int, IN `SucursalID` int, OUT `Contador` int)
BEGIN

  /*
  ****** GENERA UN TICKET DE TURNO *********
  OBTIENE EL UTIMO ULTIMO EN X DEPARTAMENTO
  
  */

  DECLARE EstadoTurnoID int;
  DECLARE Turno int;

  SET EstadoTurnoID = (SELECT
      Id
    FROM onetime.tbl_estados_turnos
    WHERE Estado = 'E');
  SET Turno = (SELECT
      COUNT(BotonTurnoID) + 1 AS Contador
    FROM tbl_administracion_turnos AS Adm
    WHERE date (Adm.FechaCreacion) = date (NOW())
    AND Adm.Activo = 1
    AND Adm.BotonTurnoID = BotonTurnoID
    AND Adm.DepartamentoID = DepartamentoID
    AND Adm.SucursalID = SucursalID);
  SET Contador = Turno;

  INSERT INTO `onetime`.`tbl_administracion_turnos` (`BotonTurnoID`,
  `Turno`,
  DepartamentoID,
  SucursalID,
  `EstadoTurnoID`,
  `FechaHoraSeleccion`,
  `CreadoPorUsuarioID`,
  `FechaCreacion`)
    VALUES (BotonTurnoID, Turno, DepartamentoID, SucursalID, EstadoTurnoID, NOW(), CreadoPorUsuarioID, NOW());


END
$$

--
-- Create procedure `SP_ActualizarEstadoTurno`
--
CREATE DEFINER = 'root'@'localhost'
PROCEDURE SP_ActualizarEstadoTurno (IN `PuestoID` int, IN `TurnoID` int, IN `CreadoPorUsuarioID` int, IN `Estado` varchar(10), IN `SucursalID` int, IN `Comentario` varchar(200), OUT `CantReLlamadas` varchar(20))
BEGIN

  DECLARE EstadoID int;
  DECLARE EstatusID int;
  IF TurnoID = '' THEN
    SET TurnoID = 0;
  END IF;


  SET EstadoID = (SELECT
      Id
    FROM tbl_estados_turnos AS e
    WHERE e.Estado = Estado
    AND e.Activo = 1);


  IF Estado IN ('E', 'T') THEN

    UPDATE onetime.tbl_administracion_turnos AS adm
    SET adm.EstadoTurnoID = EstadoID,
        adm.CreadoPorUsuarioID = CreadoPorUsuarioID
    WHERE adm.Id = TurnoID;

  ELSEIF Estado = 'L' THEN

    UPDATE onetime.tbl_administracion_turnos AS adm
    SET adm.EstadoTurnoID = EstadoID,
        adm.CantReLlamadas = (adm.CantReLlamadas + 1),
        adm.CreadoPorUsuarioID = CreadoPorUsuarioID,
        adm.FechaHoraLlamada = NOW()
    WHERE adm.Id = TurnoID;

    SET CantReLlamadas = (SELECT
        adm.CantReLlamadas
      FROM onetime.tbl_administracion_turnos AS adm
      WHERE adm.Id = TurnoID);

  ELSEIF Estado = 'A' THEN
    SET EstatusID = (SELECT
        Id
      FROM tbl_estatus_turnos AS e
      WHERE e.Estatus = 'F'
      AND e.Activo = 1);
    UPDATE onetime.tbl_administracion_turnos AS adm
    SET adm.EstadoTurnoID = EstadoID,
        adm.EstatusTurnoID = EstatusID,
        adm.CreadoPorUsuarioID = CreadoPorUsuarioID,
        adm.FechaHoraAnulacion = NOW(),
        adm.Comentario = Comentario
    WHERE adm.Id = TurnoID;

  ELSEIF Estado = 'P' THEN

    UPDATE onetime.tbl_administracion_turnos AS adm
    SET adm.EstadoTurnoID = EstadoID,
        adm.CreadoPorUsuarioID = CreadoPorUsuarioID,
        adm.FechaHoraEnPuesto = NOW()
    WHERE adm.Id = TurnoID;

  ELSEIF Estado = 'F' THEN

    SET EstadoID = IF((SELECT
        adm.EstatusTurnoID
      FROM onetime.tbl_administracion_turnos AS adm
      WHERE adm.Id = TurnoID) IS NULL, (SELECT
        Id
      FROM tbl_estados_turnos AS e
      WHERE e.Estado = 'E'
      AND e.Activo = 1), (SELECT
        Id
      FROM tbl_estados_turnos AS e
      WHERE e.Estado = 'F'
      AND e.Activo = 1));
    SET EstatusID = (SELECT
        Id
      FROM tbl_estatus_turnos AS e
      WHERE e.Estatus = 'F'
      AND e.Activo = 1);

    UPDATE onetime.tbl_administracion_turnos AS adm
    SET adm.EstadoTurnoID = EstadoID,
        adm.EstatusTurnoID = EstatusID,
        adm.ModificadoPorUsuarioID = CreadoPorUsuarioID,
        adm.FechaHoraFinalizar = NOW()
    WHERE adm.Id = TurnoID;

  ELSE
    UPDATE onetime.tbl_administracion_turnos AS adm
    SET adm.EstadoTurnoID = EstadoID,
        adm.CreadoPorUsuarioID = CreadoPorUsuarioID,
        adm.FechaHoraTransferido = NOW()
    WHERE adm.Id = TurnoID;

  END IF;


END
$$

DELIMITER ;

--
-- Create table `tbl_puestos`
--
CREATE TABLE tbl_puestos (
  Id int(11) NOT NULL AUTO_INCREMENT,
  DepartamentoID int(11) NOT NULL,
  Codigo varchar(50) DEFAULT NULL,
  Nombre varchar(100) NOT NULL,
  Descripcion text DEFAULT NULL,
  CreadoPorUsuarioID int(11) DEFAULT NULL,
  FechaCreacion datetime DEFAULT NULL,
  ModificadoPorUsuarioID int(11) DEFAULT NULL,
  FechaModificacion datetime DEFAULT NULL,
  Activo tinyint(4) DEFAULT 1,
  PRIMARY KEY (Id)
)
ENGINE = MYISAM,
AUTO_INCREMENT = 16,
AVG_ROW_LENGTH = 2048,
CHARACTER SET utf8,
CHECKSUM = 0,
COLLATE utf8_general_ci;

--
-- Create index `Codigo_UNIQUE` on table `tbl_puestos`
--
ALTER TABLE tbl_puestos
ADD UNIQUE INDEX Codigo_UNIQUE (Codigo);

--
-- Create index `Nombre_UNIQUE` on table `tbl_puestos`
--
ALTER TABLE tbl_puestos
ADD UNIQUE INDEX Nombre_UNIQUE (Nombre);

--
-- Create view `vw_puestos_sucursales`
--
CREATE
DEFINER = 'root'@'localhost'
VIEW vw_puestos_sucursales
AS
SELECT
  `puestos`.`Id` AS `PuestoID`,
  `puestos`.`Codigo` AS `PuestoCodigo`,
  `puestos`.`Nombre` AS `Puesto`,
  `puestos`.`Descripcion` AS `PuestoDescripcion`,
  `puestos`.`DepartamentoID` AS `DepartamentoID`,
  `dpt`.`Codigo` AS `DepartamentoCodigo`,
  `dpt`.`Nombre` AS `Departamento`,
  `dpt`.`Descripcion` AS `DepartamentoDescripcion`,
  `suc`.`Id` AS `SucursalID`,
  `suc`.`Nombre` AS `Sucursal`,
  `suc`.`Descripcion` AS `SucursalDescripcion`,
  `empresa`.`Id` AS `EmpresaID`,
  `empresa`.`Codigo` AS `EmpresaCodigo`,
  `empresa`.`Nombre` AS `Empresa`,
  `empresa`.`Descripcion` AS `EmpresaDescripcion`,
  `empresa`.`LogoPeq` AS `EmpresaLogoPeq`,
  `empresa`.`LogoGrande` AS `EmpresaLogoGrande`,
  `puestos`.`CreadoPorUsuarioID` AS `CreadoPorUsuarioID`,
  `puestos`.`FechaCreacion` AS `FechaCreacion`,
  `puestos`.`ModificadoPorUsuarioID` AS `ModificadoPorUsuarioID`,
  `puestos`.`FechaModificacion` AS `FechaModificacion`,
  `puestos`.`Activo` AS `Activo`
FROM (((`tbl_puestos` `puestos`
  LEFT JOIN `tbl_departamentos` `dpt`
    ON ((`puestos`.`DepartamentoID` = `dpt`.`Id`)))
  LEFT JOIN `tbl_sucursales` `suc`
    ON ((`dpt`.`SucursalID` = `suc`.`Id`)))
  LEFT JOIN `tbl_empresa` `empresa`
    ON ((`suc`.`EmpresaID` = `empresa`.`Id`)))
WHERE ((`puestos`.`Activo` = 1)
AND (`dpt`.`Activo` = 1)
AND (`suc`.`Activo` = 1)
AND (`empresa`.`Activo` = 1));

--
-- Create view `vw_administracion_turnos`
--
CREATE
DEFINER = 'root'@'localhost'
VIEW vw_administracion_turnos
AS
SELECT
  `adm`.`Id` AS `Id`,
  `adm`.`BotonTurnoID` AS `BotonTurnoID`,
  `btn`.`Nombre` AS `BotonTurno`,
  `btn`.`ValorBoton` AS `BotonTurnoValor`,
  `adm`.`Turno` AS `Turno`,
  CONCAT(`btn`.`ValorBoton`, _latin1 '-', `adm`.`Turno`) AS `TurnoConcatenado`,
  `adm`.`EstadoTurnoID` AS `EstadoTurnoID`,
  `estados`.`Estado` AS `Estado`,
  `adm`.`EstatusTurnoID` AS `EstatusTurnoID`,
  `estatus`.`Estatus` AS `Estatus`,
  `adm`.`PuestoID` AS `PuestoID`,
  `p`.`Nombre` AS `Puesto`,
  `adm`.`FechaHoraSeleccion` AS `FechaHoraSeleccion`,
  `adm`.`FechaHoraLlamada` AS `FechaHoraLlamada`,
  `adm`.`FechaHoraEnPuesto` AS `FechaHoraEnPuesto`,
  `adm`.`FechaHoraFinalizar` AS `FechaHoraFinalizar`,
  `adm`.`FechaHoraAnulacion` AS `FechaHoraAnulacion`,
  `adm`.`FechaHoraTransferido` AS `FechaHoraTransferido`,
  `adm`.`TransferidoAPuestoID` AS `TransferidoAPuestoID`,
  `adm`.`FechaHoraReLlamada` AS `FechaHoraRellamada`,
  `adm`.`CantReLlamadas` AS `CantReLlamadas`,
  `adm`.`Comentario` AS `Comentario`,
  `adm`.`ComentarioTransferencia` AS `ComentarioTransferencia`,
  `adm`.`DepartamentoID` AS `DepartamentoID`,
  `dept`.`Nombre` AS `Departamento`,
  `adm`.`SucursalID` AS `SucursalID`,
  `suc`.`Nombre` AS `Sucursal`,
  `emp`.`Id` AS `EmpresaID`,
  `emp`.`Nombre` AS `Empresa`,
  `adm`.`CreadoPorUsuarioID` AS `CreadoPorUsuarioID`,
  CONCAT(`u`.`Nombre`, _latin1 ' ', `u`.`Apellido`) AS `NombreUsuario`,
  `u`.`Usuario` AS `Usuario`,
  `adm`.`FechaCreacion` AS `FechaCreacion`,
  `adm`.`ModificadoPorUsuarioID` AS `ModificadoPorUsuarioID`,
  `adm`.`FechaModificacion` AS `FechaModificacion`,
  `adm`.`Activo` AS `Activo`,
  `adm`.`IDExterno` AS `IDExterno`,
  `adm`.`CampoExterno` AS `CampoExterno`,
  DAYOFMONTH(`adm`.`FechaCreacion`) AS `Dia`,
  MONTH(`adm`.`FechaCreacion`) AS `Mes`,
  YEAR(`adm`.`FechaCreacion`) AS `Ano`
FROM ((((((((`tbl_administracion_turnos` `adm`
  JOIN `tbl_botones_turnos` `btn`
    ON ((`adm`.`BotonTurnoID` = `btn`.`Id`)))
  LEFT JOIN `tbl_puestos` `p`
    ON ((`adm`.`PuestoID` = `p`.`Id`)))
  JOIN `tbl_departamentos` `dept`
    ON ((`adm`.`DepartamentoID` = `dept`.`Id`)))
  JOIN `tbl_sucursales` `suc`
    ON ((`adm`.`DepartamentoID` = `suc`.`Id`)))
  JOIN `tbl_empresa` `emp`
    ON ((`suc`.`EmpresaID` = `emp`.`Id`)))
  JOIN `tbl_estados_turnos` `estados`
    ON ((`adm`.`EstadoTurnoID` = `estados`.`Id`)))
  JOIN `tbl_usuarios` `u`
    ON ((`adm`.`CreadoPorUsuarioID` = `u`.`Id`)))
  LEFT JOIN `tbl_estatus_turnos` `estatus`
    ON ((`adm`.`EstatusTurnoID` = `estatus`.`Id`)));

DELIMITER $$

--
-- Create procedure `SP_GetTotalTurnosByEstadoToday`
--
CREATE DEFINER = 'root'@'localhost'
PROCEDURE SP_GetTotalTurnosByEstadoToday (IN Estado varchar(20), IN DepartamentID int, OUT Total int)
BEGIN
  IF Estado = 'null' THEN
    SET Total = (SELECT
        COUNT(*) CANTIDAD_TURNOS_HOY
      FROM onetime.vw_administracion_turnos AS a
      WHERE a.Activo = 1
      AND DATE_FORMAT(a.FechaCreacion, "%Y-%m-%d") = CURDATE()
      AND a.DepartamentoID = DepartamentID);
  ELSE
    SET Total = (SELECT
        COUNT(*) CANTIDAD_TURNOS_HOY
      FROM onetime.vw_administracion_turnos AS a
      WHERE a.Activo = 1
      AND DATE_FORMAT(a.FechaCreacion, "%Y-%m-%d") = CURDATE()
      AND a.Estado IN (Estado)
      AND a.DepartamentoID = DepartamentID);
  END IF;
END
$$

DELIMITER ;

--
-- Create table `tbl_prioridad_turnos_puestos`
--
CREATE TABLE tbl_prioridad_turnos_puestos (
  Id int(11) NOT NULL AUTO_INCREMENT,
  PrioridadID int(11) NOT NULL,
  BotonTurnoID int(11) NOT NULL,
  PuestoID int(11) NOT NULL,
  CreadoPorUsuarioID int(11) DEFAULT NULL,
  FechaCreacion datetime DEFAULT NULL,
  ModificadoPorUsuarioID int(11) DEFAULT NULL,
  FechaModificacion datetime DEFAULT NULL,
  Activo tinyint(4) DEFAULT 1,
  PRIMARY KEY (Id, PrioridadID, BotonTurnoID, PuestoID)
)
ENGINE = MYISAM,
AUTO_INCREMENT = 24,
AVG_ROW_LENGTH = 36,
CHARACTER SET latin1,
CHECKSUM = 0,
COLLATE latin1_swedish_ci;

--
-- Create table `pv_usuarios_puestos`
--
CREATE TABLE pv_usuarios_puestos (
  Id int(11) NOT NULL AUTO_INCREMENT,
  UsuarioID int(11) DEFAULT NULL,
  PuestoID int(11) DEFAULT NULL,
  CreadoPorUsuarioID int(11) DEFAULT NULL,
  FechaCreacion datetime DEFAULT NULL,
  FechaModificacion datetime DEFAULT NULL,
  ModificadoPorUsuarioID int(11) DEFAULT NULL,
  Activo tinyint(4) DEFAULT 1,
  PRIMARY KEY (Id)
)
ENGINE = MYISAM,
AUTO_INCREMENT = 53,
AVG_ROW_LENGTH = 1638,
CHARACTER SET latin1,
CHECKSUM = 0,
COLLATE latin1_swedish_ci;

--
-- Create view `vw_pvt_puestos_usuarios`
--
CREATE
DEFINER = 'root'@'localhost'
VIEW vw_pvt_puestos_usuarios
AS
SELECT
  `a`.`Id` AS `UsuarioID`,
  `b`.`PuestoID` AS `PuestoID`,
  `c`.`Puesto` AS `Puesto`,
  CONCAT(`c`.`Puesto`, _utf8 ' - ', `c`.`Departamento`, _utf8 ' - ', `c`.`Sucursal`) AS `PuestoConcatenado`
FROM ((`tbl_usuarios` `a`
  JOIN `pv_usuarios_puestos` `b`
    ON ((`a`.`Id` = `b`.`UsuarioID`)))
  JOIN `vw_puestos_sucursales` `c`
    ON ((`b`.`PuestoID` = `c`.`PuestoID`)));

--
-- Create table `tbl_prioridades_turnos`
--
CREATE TABLE tbl_prioridades_turnos (
  Id int(11) NOT NULL AUTO_INCREMENT,
  Nivel int(11) NOT NULL,
  Prioridad varchar(50) DEFAULT NULL,
  CreadoPorUsuarioID int(11) DEFAULT NULL,
  FechaCreacion datetime DEFAULT NULL,
  ModificadoPorUsuarioID int(11) DEFAULT NULL,
  FechaModificacion datetime DEFAULT NULL,
  Activo tinyint(4) DEFAULT 1,
  PRIMARY KEY (Id)
)
ENGINE = MYISAM,
AUTO_INCREMENT = 6,
AVG_ROW_LENGTH = 3276,
CHARACTER SET latin1,
CHECKSUM = 0,
COLLATE latin1_swedish_ci;

--
-- Create index `idPrioridad` on table `tbl_prioridades_turnos`
--
ALTER TABLE tbl_prioridades_turnos
ADD UNIQUE INDEX idPrioridad (Id);

--
-- Create index `Nivel_UNIQUE` on table `tbl_prioridades_turnos`
--
ALTER TABLE tbl_prioridades_turnos
ADD UNIQUE INDEX Nivel_UNIQUE (Nivel);

--
-- Create index `puesto` on table `tbl_prioridades_turnos`
--
ALTER TABLE tbl_prioridades_turnos
ADD INDEX puesto (Nivel);

--
-- Create view `vw_puestos_prioridades`
--
CREATE
DEFINER = 'root'@'localhost'
VIEW vw_puestos_prioridades
AS
SELECT
  `ptp`.`Id` AS `Id`,
  `ptp`.`PrioridadID` AS `PrioridadID`,
  `pt`.`Nivel` AS `Nivel`,
  `pt`.`Prioridad` AS `Prioridad`,
  `ptp`.`BotonTurnoID` AS `BotonTurnoID`,
  `b`.`Nombre` AS `Nombre`,
  `b`.`ValorBoton` AS `ValorBoton`,
  `ptp`.`PuestoID` AS `PuestoID`,
  `p`.`Nombre` AS `Puesto`
FROM (((`tbl_prioridad_turnos_puestos` `ptp`
  LEFT JOIN `tbl_prioridades_turnos` `pt`
    ON ((`ptp`.`PrioridadID` = `pt`.`Id`)))
  LEFT JOIN `tbl_puestos` `p`
    ON ((`ptp`.`PuestoID` = `p`.`Id`)))
  LEFT JOIN `tbl_botones_turnos` `b`
    ON ((`ptp`.`BotonTurnoID` = `b`.`Id`)));

--
-- Create view `vw_prioridades_turnos_puesto`
--
CREATE
DEFINER = 'root'@'localhost'
VIEW vw_prioridades_turnos_puesto
AS
SELECT
  `p`.`Id` AS `Id`,
  `p`.`PrioridadID` AS `PrioridadID`,
  `pt`.`Nivel` AS `Nivel`,
  `pt`.`Prioridad` AS `Prioridad`,
  `p`.`BotonTurnoID` AS `BotonTurnoID`,
  `b`.`Nombre` AS `BotonTurno`,
  `p`.`PuestoID` AS `PuestoID`,
  `pu`.`Nombre` AS `Puesto`,
  CONCAT(`pu`.`Nombre`, _utf8 ' - ', `vw_puestos`.`Departamento`, _utf8 ' - ', `vw_puestos`.`Sucursal`) AS `PuestoCon`,
  `vw_puestos`.`Departamento` AS `Departamento`,
  `vw_puestos`.`Sucursal` AS `Sucursal`,
  `p`.`Activo` AS `Activo`
FROM ((((`tbl_prioridad_turnos_puestos` `p`
  LEFT JOIN `tbl_botones_turnos` `b`
    ON ((`p`.`BotonTurnoID` = `b`.`Id`)))
  LEFT JOIN `tbl_puestos` `pu`
    ON ((`p`.`PuestoID` = `pu`.`Id`)))
  LEFT JOIN `tbl_prioridades_turnos` `pt`
    ON ((`p`.`PrioridadID` = `pt`.`Id`)))
  LEFT JOIN `vw_puestos_sucursales` `vw_puestos`
    ON ((`p`.`PuestoID` = `vw_puestos`.`PuestoID`)));

DELIMITER $$

--
-- Create procedure `SP_CambiarModoLlamadaPuesto`
--
CREATE DEFINER = 'root'@'localhost'
PROCEDURE SP_CambiarModoLlamadaPuesto (IN InPuestoID int, IN Opcion varchar(50), IN InDepartamento varchar(100))
BEGIN

  DECLARE Prioridad varchar(50);
  DECLARE IdPuestoActualizar int(50);
  DECLARE PrioridadID int;

  IF Opcion = 'ACTIVAR' THEN -- VALIDA SI DESEAS ACTIVAR EL MODO LLAMADA POR FECHA DE SELECCION O DESACTIVAR DE UN PUESTO X

    SET Prioridad = (SELECT
        p.Prioridad
      FROM onetime.vw_prioridades_turnos_puesto p
      WHERE p.Prioridad = 'TODOS'
      AND p.PuestoID = InPuestoID
      AND p.Departamento = InDepartamento);

    IF Prioridad = 'TODOS' THEN -- SI EL PUESTO YA POSEE LA OPCION PERO ESTA INACTIVA, SE PROCEDERA A ACTIVAR

      SET IdPuestoActualizar = (SELECT
          E.Id
        FROM onetime.vw_prioridades_turnos_puesto AS E
        WHERE E.Prioridad = 'TODOS'
        AND E.PuestoID = InPuestoID
        AND E.Departamento = InDepartamento);
      UPDATE onetime.tbl_prioridad_turnos_puestos AS E
      SET E.Activo = 1
      WHERE E.Id = IdPuestoActualizar;

    ELSE

      -- DE LO CONTRARIO SI DESEAS ASCTIVAR LA OPCION PERO EL PUESTO NUNCA LA HA TENIDO, HARA UN INSERT EN LA TABLA CON LOS PARAMETROS CORRESPONDIENTES

      SET PrioridadID = (SELECT
          p.Id
        FROM onetime.tbl_prioridades_turnos AS p
        WHERE p.Prioridad = 'TODOS');
      INSERT INTO onetime.tbl_prioridad_turnos_puestos (PrioridadID, BotonTurnoID, PuestoID)
        VALUES (PrioridadID, 0, InPuestoID);

    END IF;

  ELSE

    -- DE LO CONTRARIO SI DESEAS DESACTIVAR LA OPCION, HARA UN UPDAT.

    SET IdPuestoActualizar = (SELECT
        E.Id
      FROM onetime.vw_prioridades_turnos_puesto AS E
      WHERE E.Prioridad = 'TODOS'
      AND E.PuestoID = InPuestoID
      AND E.Departamento = InDepartamento);
    UPDATE onetime.tbl_prioridad_turnos_puestos AS E
    SET E.Activo = 0
    WHERE E.Id = IdPuestoActualizar;

  END IF;


END
$$

DELIMITER ;

--
-- Create view `vw_administracion_turnos_prioridad_puestos`
--
CREATE
DEFINER = 'root'@'localhost'
VIEW vw_administracion_turnos_prioridad_puestos
AS
SELECT DISTINCT
  `adm`.`Id` AS `Id`,
  `p`.`PrioridadID` AS `PrioridadID`,
  `pt`.`Nivel` AS `Nivel`,
  `pt`.`Prioridad` AS `Prioridad`,
  `p`.`PuestoID` AS `PuestoIDPrioridad`,
  `adm`.`BotonTurnoID` AS `BotonTurnoID`,
  `adm`.`BotonTurno` AS `BotonTurno`,
  `adm`.`BotonTurnoValor` AS `BotonTurnoValor`,
  `adm`.`Turno` AS `Turno`,
  `adm`.`TurnoConcatenado` AS `TurnoConcatenado`,
  `adm`.`EstadoTurnoID` AS `EstadoTurnoID`,
  `adm`.`Estado` AS `Estado`,
  `adm`.`EstatusTurnoID` AS `EstatusTurnoID`,
  `adm`.`Estatus` AS `Estatus`,
  `adm`.`FechaHoraSeleccion` AS `FechaHoraSeleccion`,
  `adm`.`FechaHoraLlamada` AS `FechaHoraLlamada`,
  `adm`.`FechaHoraEnPuesto` AS `FechaHoraEnPuesto`,
  `adm`.`FechaHoraFinalizar` AS `FechaHoraFinalizar`,
  `adm`.`FechaHoraAnulacion` AS `FechaHoraAnulacion`,
  `adm`.`FechaHoraTransferido` AS `FechaHoraTransferido`,
  `adm`.`TransferidoAPuestoID` AS `TransferidoAPuestoID`,
  `adm`.`FechaHoraRellamada` AS `FechaHoraRellamada`,
  `adm`.`CantReLlamadas` AS `CantReLlamadas`,
  `adm`.`Comentario` AS `Comentario`,
  `adm`.`PuestoID` AS `PuestoID`,
  `adm`.`Puesto` AS `Puesto`,
  `adm`.`DepartamentoID` AS `DepartamentoID`,
  `adm`.`Departamento` AS `Departamento`,
  `adm`.`SucursalID` AS `SucursalID`,
  `adm`.`Sucursal` AS `Sucursal`,
  `adm`.`Empresa` AS `Empresa`,
  `adm`.`CreadoPorUsuarioID` AS `CreadoPorUsuarioID`,
  `adm`.`FechaCreacion` AS `FechaCreacion`,
  `adm`.`ModificadoPorUsuarioID` AS `ModificadoPorUsuarioID`,
  `adm`.`FechaModificacion` AS `FechaModificacion`,
  `adm`.`Activo` AS `Activo`,
  `adm`.`IDExterno` AS `IDExterno`,
  `adm`.`CampoExterno` AS `CampoExterno`,
  DAYOFMONTH(`adm`.`FechaCreacion`) AS `Dia`,
  MONTH(`adm`.`FechaCreacion`) AS `Mes`,
  YEAR(`adm`.`FechaCreacion`) AS `Ano`
FROM ((`vw_administracion_turnos` `adm`
  LEFT JOIN `tbl_prioridad_turnos_puestos` `p`
    ON ((`adm`.`BotonTurnoID` = `p`.`BotonTurnoID`)))
  LEFT JOIN `tbl_prioridades_turnos` `pt`
    ON ((`p`.`PrioridadID` = `pt`.`Id`)))
WHERE ((`adm`.`Activo` = 1)
AND (`p`.`Activo` = 1)
AND (`pt`.`Activo` = 1))
ORDER BY `pt`.`Nivel`, `adm`.`Turno`;

--
-- Create table `tbl_modulos_aplicacion`
--
CREATE TABLE tbl_modulos_aplicacion (
  Id int(11) NOT NULL AUTO_INCREMENT,
  Codigo varchar(45) DEFAULT NULL,
  Nombre varchar(45) DEFAULT NULL,
  Descripcion text DEFAULT NULL,
  CreadoPorUsuarioID int(11) DEFAULT NULL,
  FechaCreacion datetime DEFAULT NULL,
  ModificadoPorUsuarioID int(11) DEFAULT NULL,
  FechaModificacion datetime DEFAULT NULL,
  Activo tinyint(4) DEFAULT 1,
  PRIMARY KEY (Id)
)
ENGINE = MYISAM,
AUTO_INCREMENT = 3,
AVG_ROW_LENGTH = 8192,
CHARACTER SET utf8,
CHECKSUM = 0,
COLLATE utf8_general_ci;

--
-- Create index `Codigo_UNIQUE` on table `tbl_modulos_aplicacion`
--
ALTER TABLE tbl_modulos_aplicacion
ADD UNIQUE INDEX Codigo_UNIQUE (Codigo);

--
-- Create index `Nombre_UNIQUE` on table `tbl_modulos_aplicacion`
--
ALTER TABLE tbl_modulos_aplicacion
ADD UNIQUE INDEX Nombre_UNIQUE (Nombre);

--
-- Create table `tbl_perfiles_usuarios`
--
CREATE TABLE tbl_perfiles_usuarios (
  Id int(11) NOT NULL AUTO_INCREMENT,
  Perfil varchar(200) DEFAULT NULL,
  Descripcion text DEFAULT NULL,
  CreadoPorUsuarioID int(11) DEFAULT NULL,
  FechaCreacion datetime DEFAULT NULL,
  ModificadoPorUsuarioID int(11) DEFAULT NULL,
  FechaModificacion datetime DEFAULT NULL,
  Activo tinyint(4) DEFAULT 1,
  PRIMARY KEY (Id)
)
ENGINE = MYISAM,
AUTO_INCREMENT = 7,
AVG_ROW_LENGTH = 2730,
CHARACTER SET utf8,
CHECKSUM = 0,
COLLATE utf8_general_ci;

--
-- Create index `Perfil_UNIQUE` on table `tbl_perfiles_usuarios`
--
ALTER TABLE tbl_perfiles_usuarios
ADD UNIQUE INDEX Perfil_UNIQUE (Perfil);

--
-- Create view `vw_usuarios`
--
CREATE
DEFINER = 'root'@'localhost'
VIEW vw_usuarios
AS
SELECT
  `usuarios`.`Id` AS `Id`,
  `usuarios`.`Nombre` AS `Nombre`,
  `usuarios`.`Apellido` AS `Apellido`,
  `usuarios`.`Usuario` AS `Usuario`,
  `usuarios`.`Password` AS `Password`,
  `usuarios`.`Email` AS `Email`,
  `usuarios`.`PerfilUsuarioID` AS `PerfilUsuarioID`,
  `perfiles`.`Perfil` AS `Perfil`,
  `puestos`.`Id` AS `PuestoId`,
  `puestos`.`Codigo` AS `PuestoCodigo`,
  `puestos`.`Nombre` AS `Puesto`,
  `dept`.`Id` AS `DepartamentoID`,
  `dept`.`Codigo` AS `DepartamentoCodigo`,
  `dept`.`Nombre` AS `Departamento`,
  `suc`.`Id` AS `SucursalID`,
  `suc`.`Codigo` AS `SucursalCodigo`,
  `suc`.`Nombre` AS `Sucursal`,
  `empresa`.`Codigo` AS `EmpresaCodigo`,
  `empresa`.`Nombre` AS `Empresa`,
  `empresa`.`Descripcion` AS `EmpresaDescripcion`,
  `empresa`.`LogoPeq` AS `EmpresaLogo`,
  `usuarios`.`Imagen` AS `Imagen`,
  `usuarios`.`CreadoPorUsuarioID` AS `CreadoPorUsuarioID`,
  `usuarios`.`FechaCreacion` AS `FechaCreacion`,
  `usuarios`.`Activo` AS `Activo`
FROM ((((((`tbl_usuarios` `usuarios`
  LEFT JOIN `tbl_perfiles_usuarios` `perfiles`
    ON ((`usuarios`.`PerfilUsuarioID` = `perfiles`.`Id`)))
  LEFT JOIN `pv_usuarios_puestos` `pv_usp`
    ON ((`pv_usp`.`UsuarioID` = `usuarios`.`Id`)))
  LEFT JOIN `tbl_puestos` `puestos`
    ON ((`pv_usp`.`PuestoID` = `puestos`.`Id`)))
  LEFT JOIN `tbl_departamentos` `dept`
    ON ((`puestos`.`DepartamentoID` = `dept`.`Id`)))
  LEFT JOIN `tbl_sucursales` `suc`
    ON ((`dept`.`SucursalID` = `suc`.`Id`)))
  LEFT JOIN `tbl_empresa` `empresa`
    ON ((`suc`.`EmpresaID` = `empresa`.`Id`)));

--
-- Create table `tbl_perfiles_usuarios_permisos_modulos`
--
CREATE TABLE tbl_perfiles_usuarios_permisos_modulos (
  Id int(11) NOT NULL AUTO_INCREMENT,
  PerfilUsuarioID int(11) NOT NULL,
  ModuloID int(11) NOT NULL,
  CreadoPorUsuarioID int(11) DEFAULT NULL,
  FechaCreacion datetime DEFAULT NULL,
  ModificadoPorUsuarioID int(11) DEFAULT NULL,
  FechaModificacion datetime DEFAULT NULL,
  Activo tinyint(4) DEFAULT 1,
  PRIMARY KEY (Id)
)
ENGINE = MYISAM,
AUTO_INCREMENT = 3,
AVG_ROW_LENGTH = 8192,
CHARACTER SET utf8,
CHECKSUM = 0,
COLLATE utf8_general_ci;

--
-- Create view `vw_permisos_modulos_usuarios`
--
CREATE
DEFINER = 'root'@'localhost'
VIEW vw_permisos_modulos_usuarios
AS
SELECT
  `p`.`Id` AS `PerfilID`,
  `p`.`Perfil` AS `Perfil`,
  `m`.`Id` AS `ModuloID`,
  `m`.`Codigo` AS `Codigo`,
  `m`.`Nombre` AS `Modulo`,
  `m`.`Descripcion` AS `DescripcionModulo`
FROM ((`tbl_perfiles_usuarios_permisos_modulos` `pm`
  LEFT JOIN `tbl_perfiles_usuarios` `p`
    ON ((`pm`.`PerfilUsuarioID` = `p`.`Id`)))
  LEFT JOIN `tbl_modulos_aplicacion` `m`
    ON ((`pm`.`ModuloID` = `m`.`Id`)))
WHERE (`pm`.`Activo` = 1);

--
-- Create table `pv_botones_turnos_departamentos`
--
CREATE TABLE pv_botones_turnos_departamentos (
  Id int(11) NOT NULL AUTO_INCREMENT,
  BotonTurnoID int(11) NOT NULL,
  DepartamentoID int(11) NOT NULL,
  CreadoPorUsuarioID int(11) NOT NULL,
  FechaCreacion datetime NOT NULL,
  FechaModificacion datetime DEFAULT NULL,
  ModificadoPorUsuarioID int(11) DEFAULT NULL,
  Activo tinyint(4) DEFAULT 1,
  PRIMARY KEY (Id)
)
ENGINE = MYISAM,
AUTO_INCREMENT = 37,
AVG_ROW_LENGTH = 2730,
CHARACTER SET latin1,
CHECKSUM = 0,
COLLATE latin1_swedish_ci;

--
-- Create view `vw_botones_departamentos`
--
CREATE
DEFINER = 'root'@'localhost'
VIEW vw_botones_departamentos
AS
SELECT
  `a`.`Id` AS `Id`,
  `a`.`BotonTurnoID` AS `BotonTurnoID`,
  CONCAT(`c`.`Nombre`, _latin1 ' - ', `c`.`TipoBoton`) AS `Boton`,
  `a`.`DepartamentoID` AS `DepartamentoID`,
  `c`.`Icono` AS `Icono`,
  `c`.`Color` AS `Color`,
  `c`.`TextoGraMostrar` AS `TextoGraMostrar`,
  `c`.`TextoPeqMostrar` AS `TextoPeqMostrar`,
  `c`.`ValorBoton` AS `ValorBoton`,
  `c`.`TipoBoton` AS `TipoBoton`,
  `c`.`Logo` AS `Logo`,
  CONCAT(`b`.`Departamento`, _utf8 ' - ', `b`.`Sucursal`, _utf8 ' - ', `b`.`Empresa`) AS `Departamento`,
  `a`.`Activo` AS `Activo`
FROM ((`pv_botones_turnos_departamentos` `a`
  JOIN `tbl_botones_turnos` `c`
    ON ((`a`.`BotonTurnoID` = `c`.`Id`)))
  LEFT JOIN `vw_departamentos_sucursales` `b`
    ON ((`a`.`DepartamentoID` = `b`.`Id`)));

--
-- Create table `tmp_turnos_espera`
--
CREATE TABLE tmp_turnos_espera (
  Id int(11) NOT NULL AUTO_INCREMENT,
  TurnoConcatenado varchar(50) CHARACTER SET utf8 COLLATE utf8_general_ci DEFAULT NULL,
  Estado varchar(50) CHARACTER SET utf8 COLLATE utf8_general_ci DEFAULT NULL,
  Estatus varchar(50) CHARACTER SET utf8 COLLATE utf8_general_ci DEFAULT NULL,
  FechaHoraSeleccion datetime DEFAULT NULL,
  PRIMARY KEY (Id)
)
ENGINE = MYISAM,
AUTO_INCREMENT = 3,
AVG_ROW_LENGTH = 28,
CHARACTER SET latin1,
CHECKSUM = 0,
COLLATE latin1_swedish_ci;

DELIMITER $$

--
-- Create procedure `SP_GetListTurnosEsperaByPuesto`
--
CREATE DEFINER = 'root'@'localhost'
PROCEDURE SP_GetListTurnosEsperaByPuesto (IN InSucursalID int, IN InPuestoIDPrioridad int, IN InPuesto nvarchar(50))
BEGIN

  IF InPuesto = 'TOMA DE MUESTRA' THEN

    TRUNCATE TABLE tmp_turnos_espera;

    INSERT INTO tmp_turnos_espera (TurnoConcatenado, Estado, Estatus, FechaHoraSeleccion)
      SELECT DISTINCT
        adm.TurnoConcatenado,
        adm.Estado,
        adm.Estatus,
        adm.FechaHoraSeleccion
      FROM onetime.vw_administracion_turnos adm
      WHERE adm.Estado IN ('E')
      AND adm.Estatus IS NOT NULL
      AND adm.EstatusTurnoID IS NOT NULL
      AND adm.SucursalID = InSucursalID
      AND adm.Activo = 1
      AND adm.Dia = DAY(NOW())
      AND adm.Mes = MONTH(NOW());

    INSERT INTO tmp_turnos_espera (TurnoConcatenado, Estado, Estatus, FechaHoraSeleccion)
      SELECT DISTINCT
        adm.TurnoConcatenado,
        adm.Estado,
        adm.Estatus,
        adm.FechaHoraSeleccion
      FROM onetime.vw_administracion_turnos adm
      WHERE adm.Estado IN ('E', 'T')
      AND adm.Estatus IS NULL
      AND adm.SucursalID = InSucursalID
      AND adm.Activo = 1
      AND adm.Dia = DAY(NOW())
      AND adm.Mes = MONTH(NOW());

    SELECT DISTINCT
      *
    FROM tmp_turnos_espera
    ORDER BY FechaHoraSeleccion;


  ELSE

    SELECT DISTINCT
      adm.TurnoConcatenado,
      adm.Estado,
      adm.Estatus,
      adm.FechaHoraSeleccion
    FROM onetime.vw_administracion_turnos_prioridad_puestos adm
    WHERE adm.Estado IN ('E', 'T')
    AND adm.Estatus IS NULL
    AND adm.SucursalID = InSucursalID
    AND adm.PuestoIDPrioridad = InPuestoIDPrioridad
    AND adm.Activo = 1
    AND adm.Dia = DAY(NOW())
    AND adm.Mes = MONTH(NOW());

  END IF;

END
$$

DELIMITER ;

--
-- Create table `tmp_turnos_ordenados`
--
CREATE TABLE tmp_turnos_ordenados (
  TurnoID int(11) DEFAULT NULL,
  FechaHoraSeleccion datetime DEFAULT NULL,
  Secuencia int(11) DEFAULT NULL
)
ENGINE = MYISAM,
CHARACTER SET latin1,
CHECKSUM = 0,
COLLATE latin1_swedish_ci;

DELIMITER $$

--
-- Create procedure `SP_GenerarLlamadaTurno_ORIGINAL`
--
CREATE DEFINER = 'root'@'localhost'
PROCEDURE SP_GenerarLlamadaTurno_ORIGINAL (IN `InPuestoID` int, IN `InCreadoPorUsuarioID` int, IN `InSucursalID` int, IN `InDepartamentoID` int, OUT `Turno` varchar(50), OUT `TurnoID` int)
BEGIN

  DECLARE Puesto varchar(100);
  DECLARE ExistenTurnos int;
  DECLARE CantidadLlamadas int;
  DECLARE TurnoSalida varchar(25);

  TRUNCATE TABLE tmp_turnos_ordenados;

  SET Puesto = (SELECT
      p.Nombre
    FROM onetime.tbl_puestos AS p
    WHERE p.Id = InPuestoID);

  -- SI EL PUESTO ES TOMA DE MUESTRA SE EJECUTARA LA SIGUIENTE SENTENCIA
  IF Puesto = 'TOMA DE MUESTRA' THEN

    INSERT INTO tmp_turnos_ordenados (TurnoID, TurnoConcatenado, FechaHoraSeleccion)
      SELECT DISTINCT
        a.Id,
        a.TurnoConcatenado,
        a.FechaHoraSeleccion
      FROM onetime.vw_administracion_turnos a
      WHERE a.BotonTurnoValor = 'T'
      AND a.Estado IN ('E')
      AND a.Estatus IS NULL
      AND date (a.FechaCreacion) = date (NOW())
      AND a.DepartamentoID = InDepartamentoID
      AND a.SucursalID = InSucursalID
      AND a.Activo = 1
      ORDER BY a.FechaHoraSeleccion;


    INSERT INTO tmp_turnos_ordenados (TurnoID, TurnoConcatenado, FechaHoraSeleccion)
      SELECT DISTINCT
        a.Id,
        a.TurnoConcatenado,
        a.FechaHoraSeleccion
      FROM onetime.vw_administracion_turnos a
      WHERE a.Estatus IN ('F')
      AND a.Estado IN ('E')
      AND a.BotonTurnoValor NOT IN ('T')
      AND date (a.FechaCreacion) = date (NOW())
      AND a.DepartamentoID = InDepartamentoID
      AND a.SucursalID = InSucursalID
      AND a.Activo = 1
      ORDER BY a.FechaHoraSeleccion;

    SET TurnoID = (SELECT
        *
      FROM tmp_turnos_ordenados
      ORDER BY FechaHoraSeleccion LIMIT 1);
  --  SELECT TurnoSalida;

  /*  = ();
 INSERT INTO tmp_turnos_ordenados (TurnoID, TurnoConcatenado) values (100, TurnoSalida);
*/

  ELSE

    -- SI NO ES EL PUESTO TOMA DE MUESTRA, TRAEME EL SIGUIENTE TURNO DE ACUERDO A TU PUESTO

    SET TurnoSalida = (SELECT
        adm.Id
      FROM onetime.vw_administracion_turnos_prioridad_puestos AS adm
      WHERE adm.PuestoIDPrioridad = InPuestoID
      AND adm.Estado = 'E'
      AND adm.Estatus IS NULL
      AND date (adm.FechaCreacion) = date (NOW())
      AND adm.DepartamentoID = InDepartamentoID
      AND adm.SucursalID = InSucursalID
      AND adm.Activo = 1
      ORDER BY adm.Nivel, adm.Turno ASC LIMIT 1);



  END IF;



  IF TurnoSalida IS NOT NULL THEN

    SET CantidadLlamadas = (SELECT
        (IFNULL(cant.CantReLlamadas, 0) + 1) CantReLlamadas
      FROM onetime.vw_administracion_turnos cant
      WHERE cant.Id = TurnoSalida LIMIT 1);


  /*  UPDATE onetime.tbl_administracion_turnos AS adm
    SET adm.PuestoID = InPuestoID,
    adm.EstadoTurnoID =  (SELECT Id FROM tbl_estados_turnos  WHERE Estado = 'L' LIMIT 1),
    adm.CantReLlamadas  =  CantidadLlamadas,
    adm.FechaHoraLlamada = NOW(),
    adm.CreadoPorUsuarioID = InCreadoPorUsuarioID
    WHERE adm.Id = TurnoID;

	SET Turno = (SELECT adm.TurnoConcatenado FROM onetime.vw_administracion_turnos adm WHERE adm.Id = TurnoID LIMIT 1);
*/
  ELSE
    SET Turno = 0;
    SET TurnoID = 0;
  --  INSERT INTO tmp_turnos_ordenados (TurnoID, TurnoConcatenado) values (0, 'NO');


  END IF;


END
$$

--
-- Create procedure `SP_GenerarLlamadaTurno`
--
CREATE DEFINER = 'root'@'localhost'
PROCEDURE SP_GenerarLlamadaTurno (IN `InPuestoID` int, IN `InCreadoPorUsuarioID` int, IN `InSucursalID` int, IN `InDepartamentoID` int, OUT `Turno` varchar(50), OUT `TurnoID` int)
BEGIN

  DECLARE Puesto varchar(100);
  DECLARE LlamadaPorHoraLLegada varchar(50);
  DECLARE ExistenTurnos int;
  DECLARE CreadoPorUsuarioID int;
  DECLARE TurnoIDSeleccionado varchar(45);
  DECLARE TurnoSeleccionado varchar(45);


  SET Puesto = (SELECT
      p.Nombre
    FROM onetime.tbl_puestos AS p
    WHERE p.Id = InPuestoID
    AND p.Activo = 1);

  -- VALIDAR SI EL PUESTO POSEE LA OPCION DE LLAMADA POR HORA DE TOMA TURNO

  SET LlamadaPorHoraLLegada = (SELECT
      p.Prioridad
    FROM onetime.vw_prioridades_turnos_puesto AS p
    WHERE p.PuestoID = InPuestoID
    AND p.Prioridad = 'TODOS'
    AND p.Activo = 1);


  -- SI EL PUESTO ES TOMA DE MUESTRA SE EJECUTARA LA SIGUIENTE SENTENCIA
  IF Puesto IN ('TOMA DE MUESTRA', 'TOMA DE MUESTRA 2', 'TOMA DE MUESTRA 3') THEN

    -- INSERTARA EN UNA TABLA TEMPORAL LOS TURNOS QUE VAYAN DIRECTO A TOMA DE MUESTRA VS LOS QUE VAN POR EL FLUJO NORMAL

    INSERT INTO tmp_turnos_ordenados (TurnoID, FechaHoraSeleccion, Secuencia)
      SELECT DISTINCT
        a.Id,
        a.FechaHoraSeleccion,
        CASE WHEN a.BotonTurnoValor IN ('M') THEN 0 -- MUESTRA PENDIENTE
          WHEN a.BotonTurnoValor IN ('T') THEN 1  -- TOMA DE MUESTRA
          ELSE 2 END AS Secuencia
      FROM onetime.vw_administracion_turnos a
      WHERE a.BotonTurnoValor IN ('T', 'M') -- TOMA DE MUESTRA = T, TOMA DE MUESTRA EXPRESO O ANALISIS FACTURADO
      AND a.Estado IN ('E', 'T') -- ESPERA, TRANSFERIDO
      AND a.Estatus IS NULL
      AND date (a.FechaCreacion) = date (NOW())
      AND a.DepartamentoID = InDepartamentoID
      AND a.SucursalID = InSucursalID
      AND a.Activo = 1
      ORDER BY a.FechaHoraSeleccion;


    INSERT INTO tmp_turnos_ordenados (TurnoID, FechaHoraSeleccion, Secuencia)
      SELECT DISTINCT
        a.Id,
        a.FechaHoraSeleccion,
        CASE WHEN a.BotonTurnoValor IN ('P') THEN 0 -- PREFERENCIAL Y ANALISIS FACTURADO
          ELSE 2 END AS 'Secuencia'
      FROM onetime.vw_administracion_turnos a
      WHERE a.Estatus IN ('F') -- FINALIZADO
      AND a.Estado IN ('E') -- ESPERA
      AND a.BotonTurnoValor NOT IN ('T', 'R', 'M') -- EXCLUIR LOS TURNOS PARA ENTREGA DE RESULTADOS Y TOMA DE MUESTRA
      AND date (a.FechaCreacion) = date (NOW())
      AND a.DepartamentoID = InDepartamentoID
      AND a.SucursalID = InSucursalID
      AND a.Activo = 1
      ORDER BY a.FechaHoraSeleccion;




    SET TurnoIDSeleccionado := (SELECT
        b.TurnoID
      FROM tmp_turnos_ordenados b
      ORDER BY b.Secuencia, b.FechaHoraSeleccion LIMIT 1);


  -- PUESTO GENERAL: ABIERTO A TODOS LOS TURNOS POR ORDEN DE SELECCION

  ELSE
    IF Puesto = 'GENERAL' THEN

      SET TurnoIDSeleccionado = (SELECT
          adm.Id
        FROM onetime.vw_administracion_turnos AS adm
        WHERE adm.Estado IN ('E', 'T') -- ESPERA, TRANSFERIDO
        AND adm.Estatus IS NULL
        AND date (adm.FechaCreacion) = date (NOW())
        AND adm.DepartamentoID = InDepartamentoID
        AND adm.SucursalID = InSucursalID
        AND adm.Activo = 1
        ORDER BY adm.FechaHoraSeleccion ASC LIMIT 1);


    ELSE

      -- SI NO ES EL PUESTO TOMA DE MUESTRA, TRAEME EL SIGUIENTE TURNO DE ACUERDO A TU PUESTO

      IF LlamadaPorHoraLLegada = 'TODOS' THEN

        SET TurnoIDSeleccionado = (SELECT
            adm.Id
          FROM onetime.vw_administracion_turnos AS adm
          WHERE adm.Estado IN ('E', 'T') -- ESPERA, TRANSFERIDO
          AND adm.Estatus IS NULL
          AND date (adm.FechaCreacion) = date (NOW())
          AND adm.DepartamentoID = InDepartamentoID
          AND adm.SucursalID = InSucursalID
          AND adm.Activo = 1
          ORDER BY adm.FechaHoraSeleccion ASC LIMIT 1);

      ELSE

        SET TurnoIDSeleccionado = (SELECT
            adm.Id
          FROM onetime.vw_administracion_turnos_prioridad_puestos AS adm
          WHERE adm.PuestoIDPrioridad = InPuestoID
          AND adm.Estado IN ('E', 'T') -- ESPERA, TRANSFERIDO
          AND adm.Estatus IS NULL
          AND date (adm.FechaCreacion) = date (NOW())
          AND adm.DepartamentoID = InDepartamentoID
          AND adm.SucursalID = InSucursalID
          AND adm.Activo = 1
          ORDER BY adm.Nivel, adm.Turno ASC LIMIT 1);

      END IF;

    END IF;

  END IF;

  IF TurnoIDSeleccionado IS NOT NULL THEN

    UPDATE onetime.tbl_administracion_turnos AS adm
    SET adm.PuestoID = InPuestoID,
        adm.EstadoTurnoID = (SELECT
            Id
          FROM tbl_estados_turnos
          WHERE Estado = 'L' LIMIT 1),
        adm.CantReLlamadas = 1,
        adm.FechaHoraLlamada = NOW(),
        adm.CreadoPorUsuarioID = InCreadoPorUsuarioID
    WHERE adm.Id = TurnoIDSeleccionado;

    SET TurnoID = TurnoIDSeleccionado;
    SET Turno = (SELECT
        adm.TurnoConcatenado
      FROM onetime.vw_administracion_turnos adm
      WHERE adm.Id = TurnoIDSeleccionado
      AND adm.Activo = 1 LIMIT 1);

    TRUNCATE TABLE tmp_turnos_ordenados;

  ELSE

    SET Turno = 0;
    SET TurnoID = 0;

    TRUNCATE TABLE tmp_turnos_ordenados;


  END IF;



END
$$

DELIMITER ;

--
-- Create table `tbl_videos`
--
CREATE TABLE tbl_videos (
  Id int(11) NOT NULL AUTO_INCREMENT,
  Nombre varchar(50) DEFAULT NULL,
  VideoLink text NOT NULL,
  CreadoPorUsuarioID int(11) NOT NULL,
  FechaCreacion datetime NOT NULL,
  ModificadoPorUsuarioID int(11) DEFAULT NULL,
  FechaModificacion datetime NOT NULL,
  Activo tinyint(4) NOT NULL DEFAULT 1,
  PRIMARY KEY (Id)
)
ENGINE = MYISAM,
CHARACTER SET utf8,
CHECKSUM = 0,
COLLATE utf8_general_ci;

--
-- Create table `tbl_tiempo_atencion_turnos`
--
CREATE TABLE tbl_tiempo_atencion_turnos (
  Id int(11) NOT NULL AUTO_INCREMENT,
  BotonTurnoID int(11) DEFAULT NULL,
  Descripcion text DEFAULT NULL,
  TiempoMin time DEFAULT NULL,
  TiempoMax time DEFAULT NULL,
  CreadoPorUsuarioID int(11) DEFAULT NULL,
  FechaCreacion datetime DEFAULT NULL,
  ModificadoPorUsuarioID int(11) DEFAULT NULL,
  FechaModificacion datetime DEFAULT NULL,
  Activo tinyint(4) DEFAULT 1,
  PRIMARY KEY (Id)
)
ENGINE = MYISAM,
CHARACTER SET utf8,
CHECKSUM = 0,
COLLATE utf8_general_ci;

--
-- Create table `tbl_system_app`
--
CREATE TABLE tbl_system_app (
  Id int(11) NOT NULL AUTO_INCREMENT,
  Campo varchar(255) CHARACTER SET utf8 COLLATE utf8_general_ci DEFAULT NULL,
  Valor varchar(255) CHARACTER SET utf8 COLLATE utf8_general_ci DEFAULT NULL,
  Descripcion varchar(255) DEFAULT NULL,
  FechaCreacion date DEFAULT NULL,
  FechaModificacion date DEFAULT NULL,
  CreadoPorUsuarioID int(11) DEFAULT NULL,
  ModificadoPorUsuarioID int(11) NOT NULL,
  PRIMARY KEY (Id)
)
ENGINE = MYISAM,
AUTO_INCREMENT = 4,
AVG_ROW_LENGTH = 56,
CHARACTER SET latin1,
CHECKSUM = 0,
COLLATE latin1_swedish_ci;

--
-- Create table `tbl_marquesina_pantalla`
--
CREATE TABLE tbl_marquesina_pantalla (
  Id int(11) NOT NULL AUTO_INCREMENT,
  DepartamentoID int(11) NOT NULL,
  TextoMostrar text NOT NULL,
  HoraInicial time NOT NULL,
  FechaInicial date NOT NULL,
  HoraFinal time NOT NULL,
  FechaFinal date NOT NULL,
  CreadoPorUsuarioID int(11) NOT NULL,
  FechaCreacion datetime NOT NULL,
  ModificadoPorUsuarioID int(11) NOT NULL,
  FechaModificacion datetime NOT NULL,
  Activo tinyint(4) NOT NULL DEFAULT 1,
  PRIMARY KEY (Id)
)
ENGINE = MYISAM,
AUTO_INCREMENT = 4,
AVG_ROW_LENGTH = 5461,
CHARACTER SET utf8,
CHECKSUM = 0,
COLLATE utf8_general_ci;

--
-- Create index `sucursal_id` on table `tbl_marquesina_pantalla`
--
ALTER TABLE tbl_marquesina_pantalla
ADD INDEX sucursal_id (DepartamentoID);

--
-- Create table `tbl_log_usuarios`
--
CREATE TABLE tbl_log_usuarios (
  LogID int(11) NOT NULL AUTO_INCREMENT,
  UsuarioID int(11) NOT NULL,
  Online tinyint(4) NOT NULL,
  FechaLogin datetime NOT NULL,
  FechaLogout datetime NOT NULL,
  Ausente tinyint(4) NOT NULL,
  FechaAusenteSalida datetime NOT NULL,
  FechaAusenteRegreso datetime NOT NULL,
  PRIMARY KEY (LogID)
)
ENGINE = MYISAM,
CHARACTER SET utf8,
CHECKSUM = 0,
COLLATE utf8_general_ci;

--
-- Create table `tbl_log_administracion_turnos`
--
CREATE TABLE tbl_log_administracion_turnos (
  LogID int(11) NOT NULL AUTO_INCREMENT,
  Accion varchar(150) DEFAULT NULL,
  Descripcion text DEFAULT NULL,
  IDAfectado int(11) DEFAULT NULL,
  UsuarioID int(11) DEFAULT NULL,
  FechaHora datetime DEFAULT NULL,
  PRIMARY KEY (LogID)
)
ENGINE = MYISAM,
AUTO_INCREMENT = 57,
AVG_ROW_LENGTH = 56,
CHARACTER SET utf8,
CHECKSUM = 0,
COLLATE utf8_general_ci;

-- 
-- Dumping data for table tmp_turnos_ordenados
--
-- Table onetime.tmp_turnos_ordenados does not contain any data (it is empty)

-- 
-- Dumping data for table tmp_turnos_espera
--
INSERT INTO tmp_turnos_espera VALUES
(1, 'M-1', 'E', 'F', '2018-05-05 14:40:10'),
(2, 'T-1', 'E', 'F', '2018-05-05 14:40:17');

-- 
-- Dumping data for table tbl_videos
--
-- Table onetime.tbl_videos does not contain any data (it is empty)

-- 
-- Dumping data for table tbl_usuarios
--
INSERT INTO tbl_usuarios VALUES
(1, 4, 4, 'Admin', 'System', 'admin', '12345', 'admin@gmail.com', '170902081044-foto1.jpg', '1', '2017-05-20 00:00:00', 3, '2017-09-04 00:00:00', 1),
(2, 5, 0, 'PONCHE', 'OFICINA PRINCIPAL', 'poncheop', '12345', '', '180504082028-coding-html-icon.png', '1', '2017-09-02 00:00:00', 1, '2018-05-04 00:00:00', 1),
(3, 1, 0, 'Oficial1', 'Servicio al Cliente - OP', 'oficial1', '12345', 'oficial1@gmail.com', '180504082410-usuario.png', '1', '2017-09-04 00:00:00', 1, '2018-05-04 00:00:00', 1),
(5, 6, 0, 'PANTALLA - DEPT. SERVICIO AL CLIENTE', 'OFICINA PRINCIPAL', 'pantallaop', '12345', 'pantalla@gmail.com', '180504082041-coding-html-icon.png', '3', '2017-09-04 00:00:00', 1, '2018-05-04 00:00:00', 1),
(6, 5, 0, 'PONCHE 2', 'OFICINA PRINCIPAL', 'poncheop2', '12345', 'ponche2@gmail.com', '180504082111-coding-html-icon.png', '3', '2017-09-04 00:00:00', 1, '2018-05-04 00:00:00', 1),
(8, 6, 0, 'PANTALLA - DEPT.  UROLOGIA', 'OFICINA PRINCIPAL', 'pantallaop2', '12345', 'pantalla2@gmail.com', '180504082126-coding-html-icon.png', '3', '2017-09-04 00:00:00', 1, '2018-05-04 00:00:00', 1),
(9, 3, 0, 'Analista 1', 'Servicio al Cliente - OP', 'analistaop1', '12345', 'analista@gmail.com', '180504082240-descarga (1).png', '1', '2017-11-18 00:00:00', 1, '2018-05-04 00:00:00', 1),
(10, 1, 2, 'Oficial 2', 'Servicio al Cliente - OP', 'oficial2', '12345', 'oficial2@gmail.com', '180504082222-usuario.png', '1', '2018-04-14 00:00:00', 1, '2018-05-04 00:00:00', 1),
(11, 1, 0, 'Oficial 3', 'Servicio al Cliente - OP', 'oficial3', '12345', 'oficial3@gmail.com', '180504083005-usuario.png', '1', '2018-05-04 00:00:00', 1, '2018-05-04 00:00:00', 1),
(12, 3, 0, 'Analista 2', 'Servicio al Cliente - OP', 'analistaop2', '12345', 'analistaop2@gmail.com', '180504083256-descarga (1).png', '1', '2018-05-04 00:00:00', 1, '2018-05-04 00:00:00', 1),
(13, 1, 0, 'Entrega', 'Resultados', 'eresultadosop1', '12345', 'entregaresultados@patriarivas.com.do', '180504083441-user.png', '1', '2018-05-04 00:00:00', 1, '2018-05-05 00:00:00', 1),
(14, 3, 0, 'analistaop3', 'SERVICIO AL CLIENTE', 'analistaop3', '12345', 'analistaop3@gmail.com', '180505035224-usuario.png', '1', '2018-05-05 00:00:00', NULL, NULL, 1),
(15, 1, 0, 'eresultadosop2', 'servicio al cliente', 'eresultadosop2', '12345', 'eresultadosop2@gmail.com', '180505035834-usuario.png', '1', '2018-05-05 00:00:00', NULL, NULL, 1);

-- 
-- Dumping data for table tbl_tiempo_atencion_turnos
--
-- Table onetime.tbl_tiempo_atencion_turnos does not contain any data (it is empty)

-- 
-- Dumping data for table tbl_system_app
--
INSERT INTO tbl_system_app VALUES
(1, 'PlayListYoutube', 'PLyhpQavkD-InidPbxD6dyANNtjvjGpUtJ', 'Listado', NULL, '2018-04-23', NULL, 3),
(2, 'PantallaLlamadaPorVoz', 'true', NULL, NULL, '2018-04-29', NULL, 1),
(3, 'Debug', 'false', NULL, NULL, '2018-04-22', NULL, 3);

-- 
-- Dumping data for table tbl_sucursales
--
INSERT INTO tbl_sucursales VALUES
(1, 1, 'SUC-OP', 'OFICINA PRINCIPAL', '', '', '(626) 262-6262', 5, '2017-07-23 00:00:00', 1, '2018-04-21 00:00:00', 1);

-- 
-- Dumping data for table tbl_puestos
--
INSERT INTO tbl_puestos VALUES
(1, 1, 'PT-1', 'PUESTO 1', 'FACTURACION - SERVICIO AL CLIENTE - OP', 3, '2017-07-28 00:00:00', 1, '2018-05-04 00:00:00', 1),
(2, 1, 'PT-2', 'PUESTO 2', 'FACTURACION 2 - SERVICIO AL CLIENTE - OP', 3, '2017-07-28 00:00:00', 1, '2018-05-04 00:00:00', 1),
(4, 1, 'P-PONCHE', 'PONCHE', 'PONCHE - SERVICIO AL CLIENTE - OP', 5, '2017-07-28 00:00:00', 1, '2018-05-04 00:00:00', 1),
(5, 1, 'P-PANTALLA', 'PANTALLA - DEPT. SERVICIO AL CLIENTE', 'PANTALLA SERVICIO AL CLIENTE', 1, '2017-09-03 00:00:00', 1, '2017-09-03 00:00:00', 1),
(6, 3, 'P-PONCHE 2', 'PONCHE 2', '', 3, '2017-09-04 00:00:00', NULL, NULL, 1),
(7, 3, 'P-PANTALLA2', 'PANTALLA - DEPT.  UROLOGIA', '', 3, '2017-09-04 00:00:00', NULL, NULL, 1),
(9, 1, 'PT-TM-1', 'TOMA DE MUESTRA', 'TOMA DE MUESTRA - SERVICIO AL CLIENTE - OP', 1, '2017-11-19 00:00:00', NULL, NULL, 1),
(10, 1, 'PT-GENERAL', 'GENERAL', 'ADMITE TODOS LOS TURNOS', 1, '2017-11-25 00:00:00', NULL, NULL, 1),
(11, 1, 'PT-TM-2', 'TOMA DE MUESTRA 2', 'TOMA DE MUESTRA 2 - SERVICIO AL CLIENTE - OP', 1, '2018-05-04 00:00:00', 1, '2018-05-04 00:00:00', 1),
(12, 1, 'PT-3', 'PUESTO 3', 'FACTURACION 3 - SERVICIO AL CLIENTE - OP', 1, '2018-05-04 00:00:00', NULL, NULL, 1),
(13, 1, 'PT-ER1', 'ENTREGA DE RESULTADOS', 'ENTREGA DE RESULTADOS - SERVICIO AL CLIENTE - OP', 1, '2018-05-04 00:00:00', NULL, NULL, 1),
(14, 1, 'PT-TM-3', 'TOMA DE MUESTRA 3', '', 1, '2018-05-05 00:00:00', NULL, NULL, 1),
(15, 1, 'PT-ER2', 'ENTREGA DE RESULTADOS 2', '', 1, '2018-05-05 00:00:00', NULL, NULL, 1);

-- 
-- Dumping data for table tbl_prioridad_turnos_puestos
--
INSERT INTO tbl_prioridad_turnos_puestos VALUES
(1, 5, 0, 10, 3, '2017-08-16 00:00:00', 1, '2017-11-25 00:00:00', 1),
(2, 2, 1, 1, 6, '2017-08-16 00:00:00', 1, '2018-05-04 00:00:00', 1),
(3, 3, 2, 1, 6, '2017-08-16 00:00:00', 1, '2018-05-04 00:00:00', 1),
(4, 1, 3, 1, 6, '2017-08-16 00:00:00', 1, '2018-05-04 00:00:00', 1),
(5, 4, 4, 1, 6, '2017-08-16 00:00:00', 1, '2018-05-01 00:00:00', 1),
(6, 2, 6, 9, 6, '2017-08-19 00:00:00', 1, '2018-05-04 00:00:00', 1),
(7, 1, 1, 2, 3, '2017-09-04 00:00:00', NULL, NULL, 1),
(8, 3, 2, 2, 1, '2017-09-10 00:00:00', 1, '2018-05-04 00:00:00', 1),
(9, 3, 5, 1, 1, '2017-12-02 00:00:00', 1, '2018-05-04 00:00:00', 0),
(10, 5, 0, 1, NULL, NULL, NULL, NULL, 0),
(11, 4, 4, 2, 1, '2018-05-04 00:00:00', NULL, NULL, 1),
(12, 2, 3, 2, 1, '2018-05-04 00:00:00', NULL, NULL, 1),
(13, 4, 4, 12, 1, '2018-05-04 00:00:00', NULL, NULL, 1),
(14, 1, 2, 12, 1, '2018-05-04 00:00:00', NULL, NULL, 1),
(15, 2, 1, 12, 1, '2018-05-04 00:00:00', NULL, NULL, 1),
(16, 3, 3, 12, 1, '2018-05-04 00:00:00', NULL, NULL, 1),
(17, 1, 5, 13, 1, '2018-05-04 00:00:00', NULL, NULL, 1),
(18, 1, 7, 9, 1, '2018-05-04 00:00:00', NULL, NULL, 1),
(19, 1, 7, 11, 1, '2018-05-04 00:00:00', NULL, NULL, 1),
(20, 2, 6, 11, 1, '2018-05-04 00:00:00', NULL, NULL, 1),
(21, 1, 7, 14, 1, '2018-05-05 00:00:00', NULL, NULL, 1),
(22, 2, 6, 14, 1, '2018-05-05 00:00:00', NULL, NULL, 1),
(23, 1, 5, 15, 1, '2018-05-05 00:00:00', NULL, NULL, 1);

-- 
-- Dumping data for table tbl_prioridades_turnos
--
INSERT INTO tbl_prioridades_turnos VALUES
(1, 2, 'ALTO', NULL, NULL, 3, '2017-07-28 00:00:00', 1),
(2, 3, 'NORMAL', NULL, NULL, 3, '2017-07-28 00:00:00', 1),
(3, 4, 'BAJO', NULL, NULL, 1, '2017-09-04 00:00:00', 1),
(4, 1, 'ESPECIAL', 3, '2017-07-28 00:00:00', 3, '2017-07-28 00:00:00', 1),
(5, 0, 'TODOS', 5, '2017-08-02 00:00:00', 5, '2017-08-02 00:00:00', 1);

-- 
-- Dumping data for table tbl_perfiles_usuarios_permisos_modulos
--
INSERT INTO tbl_perfiles_usuarios_permisos_modulos VALUES
(1, 1, 1, NULL, NULL, NULL, NULL, 1),
(2, 1, 2, NULL, NULL, NULL, NULL, 1);

-- 
-- Dumping data for table tbl_perfiles_usuarios
--
INSERT INTO tbl_perfiles_usuarios VALUES
(1, 'Oficial', '', 1, NULL, 1, '2017-09-04 00:00:00', 1),
(2, 'Sistema', NULL, NULL, NULL, NULL, NULL, 1),
(3, 'Analista', NULL, NULL, NULL, NULL, NULL, 1),
(4, 'Administrador', 'Administrador de Sistemas', 3, '2017-09-04 00:00:00', NULL, NULL, 1),
(5, 'Ponche', 'Perfil para el usuario de Ponche', 3, '2017-09-04 00:00:00', NULL, NULL, 1),
(6, 'Pantalla', 'Perfil para el usuario de pantalla', 3, '2017-09-04 00:00:00', NULL, NULL, 1);

-- 
-- Dumping data for table tbl_modulos_aplicacion
--
INSERT INTO tbl_modulos_aplicacion VALUES
(1, 'M-DASH', 'DASHBOARD', 'Pantalla Principal', NULL, NULL, 1, '2017-09-04 00:00:00', 1),
(2, 'M-PONC', 'PONCHE', 'Pantalla de Ponche', NULL, NULL, NULL, NULL, 1);

-- 
-- Dumping data for table tbl_marquesina_pantalla
--
INSERT INTO tbl_marquesina_pantalla VALUES
(1, 1, 'NO ESTAREMOS LABORANDO DEBIDO AL HURACAN HASTA EL LUNES', '02:15:00', '2017-11-11', '02:30:00', '2017-11-11', 3, '2017-09-08 00:00:00', 1, '2018-05-02 00:00:00', 0),
(2, 1, 'PRUEBA DE LA MARQUESINA', '10:10:00', '2017-09-08', '09:20:00', '2017-09-07', 3, '2017-09-09 00:00:00', 1, '2018-05-02 00:00:00', 0),
(3, 1, 'BIENVENIDOS A LOS LABORATORIOS PATRIA RIVAS', '00:00:00', '2017-11-24', '11:03:00', '2018-11-29', 3, '2017-09-09 00:00:00', 1, '2018-05-02 00:00:00', 1);

-- 
-- Dumping data for table tbl_log_usuarios
--
-- Table onetime.tbl_log_usuarios does not contain any data (it is empty)

-- 
-- Dumping data for table tbl_log_administracion_turnos
--
INSERT INTO tbl_log_administracion_turnos VALUES
(1, 'CAMBIO MODO LLAMADA', 'ACTIVAR', NULL, 3, '2018-04-21 00:00:00'),
(2, 'CAMBIO MODO LLAMADA', 'DESACTIVAR', NULL, 3, '2018-04-21 00:00:00'),
(3, 'CAMBIO MODO LLAMADA', 'ACTIVAR', NULL, 3, '2018-04-21 00:00:00'),
(4, 'CAMBIO MODO LLAMADA', 'DESACTIVAR', NULL, 3, '2018-04-21 00:00:00'),
(5, 'CAMBIO MODO LLAMADA', 'ACTIVAR', NULL, 3, '2018-04-21 00:00:00'),
(6, 'CAMBIO MODO LLAMADA', 'DESACTIVAR', NULL, 3, '2018-04-21 00:00:00'),
(7, 'CAMBIO MODO LLAMADA', 'ACTIVAR', NULL, 3, '2018-04-21 00:00:00'),
(8, 'CAMBIO MODO LLAMADA', 'DESACTIVAR', NULL, 3, '2018-04-21 00:00:00'),
(9, 'CAMBIO MODO LLAMADA', 'ACTIVAR', NULL, 3, '2018-04-21 00:00:00'),
(10, 'CAMBIO MODO LLAMADA', 'DESACTIVAR', NULL, 3, '2018-04-21 00:00:00'),
(11, 'CAMBIO MODO LLAMADA', 'ACTIVAR', NULL, 3, '2018-04-21 00:00:00'),
(12, 'CAMBIO MODO LLAMADA', 'DESACTIVAR', NULL, 3, '2018-04-21 00:00:00'),
(13, 'CAMBIO MODO LLAMADA', 'ACTIVAR', NULL, 3, '2018-04-21 00:00:00'),
(14, 'CAMBIO MODO LLAMADA', 'DESACTIVAR', NULL, 3, '2018-04-21 00:00:00'),
(15, 'CAMBIO MODO LLAMADA', 'ACTIVAR', NULL, 3, '2018-04-21 00:00:00'),
(16, 'CAMBIO MODO LLAMADA', 'DESACTIVAR', NULL, 3, '2018-04-21 00:00:00'),
(17, 'CAMBIO MODO LLAMADA', 'ACTIVAR', NULL, 3, '2018-04-21 00:00:00'),
(18, 'CAMBIO MODO LLAMADA', 'DESACTIVAR', NULL, 3, '2018-04-21 00:00:00'),
(19, 'CAMBIO MODO LLAMADA', 'ACTIVAR', NULL, 3, '2018-04-21 00:00:00'),
(20, 'CAMBIO MODO LLAMADA', 'ACTIVAR', NULL, 3, '2018-04-21 00:00:00'),
(21, 'CAMBIO MODO LLAMADA', 'ACTIVAR', NULL, 3, '2018-04-21 00:00:00'),
(22, 'CAMBIO MODO LLAMADA', 'DESACTIVAR', NULL, 3, '2018-04-21 00:00:00'),
(23, 'CAMBIO MODO LLAMADA', 'ACTIVAR', NULL, 3, '2018-04-21 00:00:00'),
(24, 'CAMBIO MODO LLAMADA', 'DESACTIVAR', NULL, 3, '2018-04-21 00:00:00'),
(25, 'TURNO REACTIVADO', 'TURNO ANULADO REACTIVADO', 14, 3, '2018-04-22 00:00:00'),
(26, 'TURNO REACTIVADO', 'TURNO ANULADO REACTIVADO', 15, 3, '2018-04-22 00:00:00'),
(27, 'TURNO REACTIVADO', 'TURNO ANULADO REACTIVADO', 14, 3, '2018-04-22 00:00:00'),
(28, 'CAMBIO MODO LLAMADA PANTALLA', 'true', NULL, 3, '2018-04-23 00:00:00'),
(29, 'CAMBIO MODO LLAMADA PANTALLA', 'false', NULL, 3, '2018-04-23 00:00:00'),
(30, 'CAMBIO MODO LLAMADA', 'ACTIVAR', NULL, 3, '2018-04-23 00:00:00'),
(31, 'CAMBIO MODO LLAMADA', 'DESACTIVAR', NULL, 3, '2018-04-23 00:00:00'),
(32, 'CAMBIO MODO DEVELOPER', 'false', NULL, 3, '2018-04-23 00:00:00'),
(33, 'CAMBIO MODO DEVELOPER', 'true', NULL, 3, '2018-04-23 00:00:00'),
(34, 'CAMBIO MODO DEVELOPER', 'false', NULL, 3, '2018-04-23 00:00:00'),
(35, 'CAMBIO MODO DEVELOPER', 'true', NULL, 3, '2018-04-23 00:00:00'),
(36, 'CAMBIO MODO DEVELOPER', 'false', NULL, 3, '2018-04-23 00:00:00'),
(37, 'CAMBIO MODO LLAMADA', 'ACTIVAR', NULL, 3, '2018-04-23 00:00:00'),
(38, 'CAMBIO MODO LLAMADA', 'DESACTIVAR', NULL, 3, '2018-04-23 00:00:00'),
(39, 'ACTUALIZAR PLAYLIST', 'list=RD9jI-z9QN6g8', NULL, 3, '2018-04-24 00:00:00'),
(40, 'ACTUALIZAR PLAYLIST', 'list=RD9jI-z9QN6g8', NULL, 3, '2018-04-24 00:00:00'),
(41, 'ACTUALIZAR PLAYLIST', 'list=RD9jI-z9QN6g8', NULL, 3, '2018-04-24 00:00:00'),
(42, 'ACTUALIZAR PLAYLIST', 'list=RD9jI-z9QN6g8', NULL, 3, '2018-04-24 00:00:00'),
(43, 'ACTUALIZAR PLAYLIST', 'list=RD9jI-z9QN6g8', NULL, 3, '2018-04-24 00:00:00'),
(44, 'ACTUALIZAR PLAYLIST', 'list=RD9jI-z9QN6g8', NULL, 3, '2018-04-24 00:00:00'),
(45, 'ACTUALIZAR PLAYLIST', 'list=RD9jI-z9QN6g8', NULL, 3, '2018-04-24 00:00:00'),
(46, 'ACTUALIZAR PLAYLIST', 'RD9jI-z9QN6g8', NULL, 3, '2018-04-24 00:00:00'),
(47, 'ACTUALIZAR PLAYLIST', 'RD9jI-z9QN6g8', NULL, 1, '2018-04-24 00:00:00'),
(48, 'TURNO TRANSFERIDO', 'TENGO QUE IR AL BANO', 40, 3, '2018-04-24 00:00:00'),
(49, 'TURNO TRANSFERIDO', 'EMERGENCIA', 3, 3, '2018-04-24 00:00:00'),
(50, 'TURNO TRANSFERIDO', 'TRANSFERIDO A PUESTO 2', 1, 3, '2018-04-24 00:00:00'),
(51, 'TURNO TRANSFERIDO', 'TRANSFERIDO A PUESTO 1', 3, 3, '2018-04-24 00:00:00'),
(52, 'CAMBIO MODO LLAMADA PANTALLA', 'true', NULL, 1, '2018-04-30 00:00:00'),
(53, 'CAMBIO MODO LLAMADA', 'ACTIVAR', NULL, 3, '2018-05-01 00:00:00'),
(54, 'CAMBIO MODO LLAMADA', 'DESACTIVAR', NULL, 3, '2018-05-01 00:00:00'),
(55, 'CAMBIO MODO LLAMADA', 'ACTIVAR', NULL, 3, '2018-05-01 00:00:00'),
(56, 'CAMBIO MODO LLAMADA', 'DESACTIVAR', NULL, 3, '2018-05-01 00:00:00');

-- 
-- Dumping data for table tbl_estatus_turnos
--
INSERT INTO tbl_estatus_turnos VALUES
(1, 'F', 'Finalizado', 1, NULL, 1, '2017-09-04 00:00:00', 1);

-- 
-- Dumping data for table tbl_estados_turnos
--
INSERT INTO tbl_estados_turnos VALUES
(1, 'E', 'EN ESPERA', 5, '2017-07-23 00:00:00', 5, '2017-07-23 00:00:00', 1),
(2, 'P', 'EN PUESTO', 5, '2017-07-23 00:00:00', 1, '2017-09-04 00:00:00', 1),
(3, 'A', 'ANULADO', 5, '2017-07-23 00:00:00', 1, '2017-09-04 00:00:00', 1),
(4, 'F', 'FINALIZADO', 5, '2017-07-23 00:00:00', NULL, NULL, 1),
(5, 'T', 'TRANSFERIDO', 5, '2017-07-23 00:00:00', NULL, NULL, 1),
(6, 'L', 'EN LLAMADA', 5, '2017-07-23 00:00:00', NULL, NULL, 1);

-- 
-- Dumping data for table tbl_empresa
--
INSERT INTO tbl_empresa VALUES
(1, 'LPR', 'LABORATORIO CLINICO PATRIA RIVAS', 'BIENVENIDO A LOS LABORATORIOS PATRIA RIVAS', 'logo.jpg', 'logopeq.jpg', '(000) 000-0000', 'JOAQUIN PEREZ, GAZCUE', '0-0000-00', 5, '2017-07-23 00:00:00', 1, '2017-09-04 00:00:00', 1);

-- 
-- Dumping data for table tbl_departamentos
--
INSERT INTO tbl_departamentos VALUES
(1, 1, 'DEPT-SERVICIO CLIENTE', 'SERVICIOS AL CLIENTE', '', 3, '2017-07-28 00:00:00', 1, '2017-09-04 00:00:00', 1);

-- 
-- Dumping data for table tbl_botones_turnos
--
INSERT INTO tbl_botones_turnos VALUES
(1, 'ARS SEMMA', 'ti-arrow-circle-left', 'primary', 'ARS SEMMA', '', 'S', 'BloqueA', '170729091128-arssemma.png', 3, '2017-07-27 00:00:00', 1, '2018-05-05 00:00:00', 1),
(2, 'ASEGURADO', 'ti-arrow-circle-left', 'info', 'ASEGURADO', '', 'A', 'BloqueA', '180502013929-seguro.png', 3, '2017-07-27 00:00:00', 1, '2018-05-02 00:00:00', 1),
(3, 'NO ASEGURADO', 'ti-arrow-circle-left', 'success', 'NO ASEGURADO', '', 'N', 'BloqueA', '180502020242-privado.png', 3, '2017-07-27 00:00:00', 1, '2018-05-02 00:00:00', 1),
(4, 'PREFERENCIAL', ' ti-arrow-circle-left', 'warning', 'PREFERENCIAL', '', 'P', 'BloqueA', '180502024509-discapacidad.png', 3, '2017-07-28 00:00:00', 1, '2018-05-02 00:00:00', 1),
(5, 'RESULTADOS', '', 'primary', 'RESULTADOS', '', 'R', 'BloqueA', '180502015025-resultados.png', 5, '2017-08-19 00:00:00', 1, '2018-05-02 00:00:00', 1),
(6, 'TOMA DE MUESTRA', '', 'danger', 'TOMA DE MUESTRA', '', 'T', 'BloqueA', '180502014013-toma_muestra.png', 5, '2017-08-19 00:00:00', 1, '2018-05-02 00:00:00', 1),
(7, 'MUESTRA PENDIENTE', '', 'danger', 'MUESTRA PENDIENTE', '', 'M', 'BloqueA', '180502025020-images.png', 1, '2018-05-02 00:00:00', 1, '2018-05-04 00:00:00', 1);

-- 
-- Dumping data for table tbl_administracion_turnos
--
-- Table onetime.tbl_administracion_turnos does not contain any data (it is empty)

-- 
-- Dumping data for table pv_usuarios_puestos
--
INSERT INTO pv_usuarios_puestos VALUES
(44, 9, 9, 1, '2018-05-04 00:00:00', NULL, NULL, 1),
(13, 1, 1, 3, '2017-09-04 00:00:00', NULL, NULL, 1),
(14, 1, 2, 3, '2017-09-04 00:00:00', NULL, NULL, 1),
(52, 13, 13, 1, '2018-05-05 00:00:00', NULL, NULL, 1),
(31, 2, 4, 1, '2018-05-04 00:00:00', NULL, NULL, 1),
(32, 5, 5, 1, '2018-05-04 00:00:00', NULL, NULL, 1),
(48, 10, 2, 1, '2018-05-04 00:00:00', NULL, NULL, 1),
(49, 12, 11, 1, '2018-05-04 00:00:00', NULL, NULL, 1),
(47, 11, 12, 1, '2018-05-04 00:00:00', NULL, NULL, 1),
(42, 3, 1, 1, '2018-05-04 00:00:00', NULL, NULL, 1),
(50, 14, 14, 1, '2018-05-05 00:00:00', NULL, NULL, 1),
(51, 15, 15, 1, '2018-05-05 00:00:00', NULL, NULL, 1);

-- 
-- Dumping data for table pv_botones_turnos_departamentos
--
INSERT INTO pv_botones_turnos_departamentos VALUES
(30, 6, 1, 1, '2018-05-05 00:00:00', NULL, NULL, 1),
(32, 5, 1, 1, '2018-05-05 00:00:00', NULL, NULL, 1),
(34, 7, 1, 1, '2018-05-05 00:00:00', NULL, NULL, 1),
(36, 1, 1, 1, '2018-05-05 00:00:00', NULL, NULL, 1),
(33, 4, 1, 1, '2018-05-05 00:00:00', NULL, NULL, 1),
(20, 3, 1, 1, '2018-05-05 00:00:00', NULL, NULL, 1),
(29, 2, 1, 1, '2018-05-05 00:00:00', NULL, NULL, 1);

-- 
-- Restore previous SQL mode
-- 
/*!40101 SET SQL_MODE=@OLD_SQL_MODE */;

-- 
-- Enable foreign keys
-- 
/*!40014 SET FOREIGN_KEY_CHECKS = @OLD_FOREIGN_KEY_CHECKS */;